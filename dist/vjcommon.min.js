(function(p,E){typeof exports=="object"&&typeof module<"u"?E(exports,require("vjmap")):typeof define=="function"&&define.amd?define(["exports","vjmap"],E):(p=typeof globalThis<"u"?globalThis:p||self,E(p.vjcommon={},p.vjmap))})(this,function(p,E){"use strict";var Nr=Object.defineProperty;var Hr=(p,E,q)=>E in p?Nr(p,E,{enumerable:!0,configurable:!0,writable:!0,value:q}):p[E]=q;var b=(p,E,q)=>(Hr(p,typeof E!="symbol"?E+"":E,q),q);const u=(o=>o&&typeof o=="object"&&"default"in o?o:{default:o})(E),tt=Object.freeze(Object.defineProperty({__proto__:null,get MapApp(){return at},get providerLayers(){return xe},get LayerBase(){return x},get exportDwg(){return nt},get setFeatureProperty(){return M},get cancelDraw(){return Ye},get drawPoint(){return dt},get drawLineSting(){return ft},get drawPolygon(){return ht},get drawFillExrusion(){return gt},get polygonToPolyline(){return ie},get drawCircle(){return yt},get drawRectangle(){return mt},get drawSlantRectangle(){return pt},get selectRotate(){return At},get toBezierCurve(){return wt},get drawEllipseFill(){return bt},get drawEllipseEdge(){return Lt},get drawEllipseFillArc(){return vt},get drawEllipseArc(){return Dt},get getGeoJsonBounds(){return Ce},get interactiveCreateGeom(){return oe},get drawArrow(){return Ct},get createLineTypePolyline(){return St},get createLineTypeCurve(){return kt},get createHatch(){return xt},get createOutSymbol(){return It},get drawText(){return Tt},get addFeaturesToDraw(){return W},get isTrackFeature(){return re},get setTrackFeatureProperty(){return _e},get getTrackFeatureProperty(){return V},get addExportRefInfoInText(){return Ae},get deleteOrModifyCadEntity(){return ve},get deleteCadEntity(){return lt},get modifyCadEntity(){return ut},get createGeomData(){return G},get loadDataToDraw(){return ct},get CacheDbStorage(){return Fe},get cacheStorage(){return X},get TsIndexDb(){return _},get initIndexDb(){return Ie},get getInstance(){return Te},get switchCadLayers(){return Ft},get switchVectorLayers(){return Qe},get setLayerOpacity(){return Pt},get setLayerToLowest(){return Et},get queryMapData(){return ee},get toProperties(){return H},get ProcessDataToFeatureCollection(){return de},get requestChangeData(){return Z},get convertArrayToGeoJson(){return fe},get evalDataConvert(){return Pe},get runMeasureCmd(){return Mt},get addHighLightSourceLayer(){return Ze},get clearHighLightSourceLayer(){return se},get getHighlightEntities(){return Ke},get clearHighlight(){return we},get selectFeatures(){return Je},get getMapSnapPoints(){return Le},get createUpdateMapStyleObj(){return Vt},get createUpdateMapStyleRasterObj(){return $e},get createUpdateMapStyleVectorObj(){return et},get listenKeyEvent(){return he},get WmsOverlayMapType(){return Oe},get createMapStyleLayerName(){return te},get getWmsMapsBounds(){return Re},get getWmsDirectTileUrl(){return je},get getWmsAutoWebBaseMapTileUrl(){return Ne},get getWmsAutoCadBaseMapTileUrl(){return He},get getWmsParamTileUrl(){return Ge},get getWmsTileUrl(){return We},get cad2webCoordinate(){return ze},get web2cadCoordinate(){return it},get overlay2BaseCoordinate(){return Ue},get base2OverlayCoordinate(){return ot},get osmProviderTiles(){return st},get tiandituProviderTiles(){return Ee},get gaodeProviderTiles(){return Me},get loadWebMap(){return Be},get toMapLayer(){return P},get sleep(){return le},get execProgram(){return Se},get getShardsTileUrl(){return ue},get getTileShards(){return ke},get isAlphanumeric(){return ce},get isWebBaseMap(){return R},get getEntityObjectId(){return $},get transformGeoJsonData(){return U}},Symbol.toStringTag,{value:"Module"}));function P(o,s){return{layerId:o.layerId,sourceId:o.sourceId,tag:o.tag,type:o.type,before:o.before,visibleOff:o.visibleOff,...s}}function le(o){return new Promise(s=>setTimeout(s,o!=null?o:100))}async function Se(o,s,t,e){const r=Object.getPrototypeOf(async function(){}).constructor;return await new r("vjmap","map","mapApp","context","common",o)(u.default,s,t,e,tt)}const ue=(o,s)=>{if(!o)return[o];if(s){let c=s.getService();o=o.replace("{serviceUrl}",c.serverUrl),o=o.replace("{accessToken}",c.accessToken)}let e=/{(\d+-\d+)}/g.exec(o);if(!e)return[o];let r=e[0];if(!r)return[o];r=r.replace("{",""),r=r.replace("}","");let i=r.split("-");if(i.length!=2)return[o];let a=+i[0],n=+i[1];if(n<=a)return[o];let l=[];for(let c=a;c<=n;c++)l.push(o.replace(e[0],c+""));return l},ke=o=>{if(!o)return{tileUrl:o,tileShards:""};let t=/{(\d+-\d+)}/g.exec(o);if(!t)return{tileUrl:o,tileShards:""};let e=t[0];if(!e)return{tileUrl:o,tileShards:""};const r=o.replace(e,"{s}");e=e.replace("{",""),e=e.replace("}","");let i=e.split("-");if(i.length!=2)return{tileUrl:o,tileShards:""};let a=+i[0],n=+i[1];if(n<=a)return{tileUrl:o,tileShards:""};let l=[];for(let c=a;c<=n;c++)l.push(c);return{tileUrl:r,tileShards:l.join(",")}},ce=o=>/^[a-zA-Z0-9]+$/.test(o),R=o=>!(o==""||o=="CAD"||o===void 0),$=o=>{let s="",t=0;for(t=0;t<o.length&&ce(o[t]);t++)s+=o[t];return s},U=(o,s,t,e,r=1,i=0)=>u.default.transform.convert(s,a=>{let n=o.fromLngLat(u.default.geoPoint(a));return n.transform(t,e,r,i),o.toLngLat(n)});class x{constructor(){b(this,"map");b(this,"mapLayer");b(this,"visibleOff")}async addLayer(s,t){this.map=s,this.mapLayer=t}setLayerStyle(s,t,e,r){this.mapLayer=P(r,e),this.removeLayer(s,t),this.addLayer(s,P(r,e))}setVisible(s,t,e){this.visibleOff=e}removeLayer(s,t){}getLayerId(){return this.mapLayer.layerId}onSourceDataChange(s,t,e,r){!this.mapLayer||!this.map||t&&this.mapLayer.sourceId!=t||this.mapLayer.disableTimerUpdate||this.visibleOff!==!0&&(this.removeLayer(s,this.mapLayer.layerId),this.addLayer(s,this.mapLayer))}async loadUrlImage(s){return new Promise((t,e)=>{const r=new Image;r.src=s,r.onload=()=>{t(r)},r.onerror=()=>{e(`load image ${s} error`)}})}evalValue(s,t,e){if(typeof s=="string")try{return new Function("props","map","vjmap",s)(t,e,u.default)}catch{}else{let r={};for(let i in s){let a=s[i];if(typeof a=="string"&&a.indexOf("return ")>=0)try{a=new Function("props","map","vjmap",a)(t,e,u.default)}catch{}r[i]=a}return r}}async createAnimateImages(s,t){var a;let e,r=Object.keys(t).filter(n=>n.indexOf("animateImages_")==0),i={};for(let n of r)i[n.replace("animateImages_","")]=t[n];if(t.animateImagesType=="arrow")e=u.default.createArrowAnimateImages(i);else if(t.animateImagesType=="antpath")e=u.default.createAntPathAnimateImages(i);else if(t.animateImagesType=="customImage"){let n=await this.loadUrlImage(t.customImageUrl),l={...i,draw:(c,h,f,g)=>{g.fillColor&&(c.fillStyle=g.fillColor,c.fillRect(0,0,h,f)),c.drawImage(n,0,0,n.width,n.height,0,f/2-n.height/2,h,n.height)}};e=u.default.createAntPathAnimateImages(l)}else if(t.animateImagesType=="animateImages"){e=[];for(let n=0;n<((a=t.animateImageUrls)==null?void 0:a.length);n++){let l=`image_animate_${t.layerId}_${n}`;s.hasImage(l)&&s.removeImage(l),await s.loadImageEx(l,t.animateImageUrls[n]),e.push(l)}}else if(t.animateImagesType=="imageSprites"){let n=await this.loadUrlImage(t.imageSpriteUrl);e=u.default.createAntPathAnimateImages({fromImage:n,...i})}else e=u.default.createAnimateImages(i);return e}setMarkerOptions(s,t){(t==null?void 0:t.minZoom)!==void 0&&s.setMinZoom(t==null?void 0:t.minZoom),(t==null?void 0:t.maxZoom)!==void 0&&s.setMaxZoom(t==null?void 0:t.maxZoom),(t==null?void 0:t.scaleMaxZoom)!==void 0&&s.setScaleMaxZoom(t==null?void 0:t.scaleMaxZoom),(t==null?void 0:t.height)!==void 0&&s.setHeight(t==null?void 0:t.height),(t==null?void 0:t.removeWhenNoInMapView)!==void 0&&s.setRemoveWhenNoInMapView(t==null?void 0:t.removeWhenNoInMapView,t==null?void 0:t.removeWhenNoInMapViewPadding),(t==null?void 0:t.rotation)!==void 0&&s.setRotation(t==null?void 0:t.rotation),(t==null?void 0:t.animationType)!==void 0&&s.setAnimation(t==null?void 0:t.animationType),(t==null?void 0:t.draggable)!==void 0&&s.setDraggable(t==null?void 0:t.draggable),(t==null?void 0:t.rotationAlignment)!==void 0&&s.setRotationAlignment(t==null?void 0:t.rotationAlignment),(t==null?void 0:t.pitchAlignment)!==void 0&&s.setPitchAlignment(t==null?void 0:t.pitchAlignment)}}class jt extends x{constructor(){super();b(this,"polyline")}async addLayer(t,e){super.addLayer(t,e),this.polyline=new u.default.Polyline(e),this.polyline.addTo(t,e.before)}setVisible(t,e,r){super.setVisible(t,e,r),r?this.polyline.hide():this.polyline.show()}removeLayer(t,e){t.removeLayerEx(e),super.removeLayer(t,e)}onSourceDataChange(t,e,r,i){r&&super.onSourceDataChange(t,e,r,i)}}class Nt extends x{constructor(){super();b(this,"polygon")}async addLayer(t,e){super.addLayer(t,e),this.polygon=new u.default.Polygon(e),this.polygon.addTo(t,e.before)}setVisible(t,e,r){super.setVisible(t,e,r),r?this.polygon.hide():this.polygon.show()}removeLayer(t,e){t.removeLayerEx(e),super.removeLayer(t,e)}onSourceDataChange(t,e,r,i){r&&super.onSourceDataChange(t,e,r,i)}}class Ht extends x{constructor(){super();b(this,"symbol")}async addLayer(t,e){super.addLayer(t,e),this.symbol=new u.default.Symbol(e),this.symbol.addTo(t,e.before)}setVisible(t,e,r){super.setVisible(t,e,r),r?this.symbol.hide():this.symbol.show()}removeLayer(t,e){t.removeLayerEx(e),super.removeLayer(t,e)}onSourceDataChange(t,e,r,i){r&&super.onSourceDataChange(t,e,r,i)}}class Gt extends x{constructor(){super();b(this,"circle")}async addLayer(t,e){super.addLayer(t,e),this.circle=new u.default.Circle(e),this.circle.addTo(t,e.before)}setVisible(t,e,r){super.setVisible(t,e,r),r?this.circle.hide():this.circle.show()}removeLayer(t,e){t.removeLayerEx(e),super.removeLayer(t,e)}onSourceDataChange(t,e,r,i){r&&super.onSourceDataChange(t,e,r,i)}}class Wt extends x{constructor(){super();b(this,"fillExtrusion")}async addLayer(t,e){super.addLayer(t,e),this.fillExtrusion=new u.default.FillExtrusion(e),this.fillExtrusion.addTo(t,e.before)}setVisible(t,e,r){super.setVisible(t,e,r),r?this.fillExtrusion.hide():this.fillExtrusion.show()}removeLayer(t,e){t.removeLayerEx(e),super.removeLayer(t,e)}onSourceDataChange(t,e,r,i){r&&super.onSourceDataChange(t,e,r,i)}}class zt extends x{constructor(){super();b(this,"heatmap")}async addLayer(t,e){super.addLayer(t,e),this.heatmap=new u.default.Heatmap(e),this.heatmap.addTo(t,e.before)}setVisible(t,e,r){super.setVisible(t,e,r),r?this.heatmap.hide():this.heatmap.show()}removeLayer(t,e){t.removeLayerEx(e),super.removeLayer(t,e)}onSourceDataChange(t,e,r,i){r&&super.onSourceDataChange(t,e,r,i)}}class Ut extends x{constructor(){super();b(this,"markers")}createMarker(t,e,r,i){var n,l,c;if(r=this.evalValue(r,e,i),r.customHtml){let h=this.evalValue(r.customHtml,e,i);r.element=h}else if(r.customImage){let h=document.createElement("div");h.className="marker",r.customImage.toLowerCase().indexOf("<svg")==0&&(r.customImage="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(r.customImage)))),h.style.backgroundImage=`url("${r.customImage}")`,h.style.width=((n=r.customImageWidth)!=null?n:40)+"px",h.style.height=((l=r.customImageHeight)!=null?l:40)+"px",h.style.backgroundSize="100%",r.element=h}let a=u.default.createMarker(r);if(a.setLngLat(t).addTo(i),r.animationType&&a.setAnimation(r.animationType),r.popupHtml){let h=new u.default.Popup({offset:(c=r.popupOffset)!=null?c:[0,0],anchor:r.popupAnchor,closeButton:r.closeButton,closeOnClick:r.closeOnClick,closeOnMove:r.closeOnMove,focusAfterOpen:r.focusAfterOpen,className:r.className,maxWidth:r.maxWidth}),f=r.popupHtml,g=this.evalValue("return `"+f+"`",e,i);h.setHTML(g),a.setPopup(h)}this.markers=this.markers||[],this.markers.push(a)}async addLayer(t,e){super.addLayer(t,e);let i=t.getSourceData(e.sourceId).features;for(let a=0;a<i.length;a++){let n=i[a].geometry;if(n.type=="Point"&&this.createMarker(n.coordinates,i[a].properties,e,t),e.isDrawLinePoint){let l=[];n.type=="LineString"?l=n.coordinates:n.type=="Polygon"&&(l=n.coordinates[0]);for(let c of l)this.createMarker(c,i[a].properties,e,t)}}}setVisible(t,e,r){super.setVisible(t,e,r);for(let i of this.markers)i.setVisible(!r,!0)}removeLayer(t,e){if(!!this.markers){for(let r of this.markers)r.remove();this.markers=[],super.removeLayer(t,e)}}}class _t extends x{constructor(){super();b(this,"popups")}createPopup(t,e,r,i){var c;let a=new u.default.Popup({offset:(c=r.offset)!=null?c:[0,0],anchor:r.anchor,closeButton:r.closeButton,closeOnClick:r.closeOnClick,closeOnMove:r.closeOnMove,focusAfterOpen:r.focusAfterOpen,className:r.className,maxWidth:r.maxWidth}),n=r.html,l=this.evalValue("return `"+n+"`",e,i);a.setHTML(l).setLngLat(t).addTo(i),this.popups=this.popups||[],this.popups.push(a)}async addLayer(t,e){super.addLayer(t,e);let i=t.getSourceData(e.sourceId).features;for(let a=0;a<i.length;a++){let n=i[a].geometry;if(n.type=="Point"&&this.createPopup(n.coordinates,i[a].properties,e,t),e.isDrawLinePoint){let l=[];n.type=="LineString"?l=n.coordinates:n.type=="Polygon"&&(l=n.coordinates[0]);for(let c of l)this.createPopup(c,i[a].properties,e,t)}}}setVisible(t,e,r){super.setVisible(t,e,r);for(let i of this.popups)i.getElement().style.display=r?"none":""}removeLayer(t,e){if(!!this.popups){for(let r of this.popups)r.remove();this.popups=[],super.removeLayer(t,e)}}}class Zt extends x{constructor(){super();b(this,"animateLine")}async addLayer(t,e){var n;super.addLayer(t,e);let r=t.getSourceData(e.sourceId),i=await this.createAnimateImages(t,e),a={...e};delete a.layerId,delete a.sourceId,this.animateLine=u.default.createAnimateLineLayer(t,r,{animateImages:i,speed:(n=e.speed)!=null?n:1,...a})}getLayerId(){return this.animateLine.layerId}setVisible(t,e,r){super.setVisible(t,e,r),r?(this.animateLine.stopAnimation(),this.animateLine.polyline.hide()):(this.animateLine.polyline.show(),this.animateLine.startAnimation())}removeLayer(t,e){this.animateLine.remove(),super.removeLayer(t,e)}}class Kt extends x{constructor(){super();b(this,"animateSymbol")}async addLayer(t,e){var n;super.addLayer(t,e);let r=t.getSourceData(e.sourceId),i=await this.createAnimateImages(t,e),a={...e};delete a.layerId,delete a.sourceId,this.animateSymbol=u.default.createAnimateSymbolLayer(t,r,{animateImages:i,speed:(n=e.speed)!=null?n:1,...a})}getLayerId(){return this.animateSymbol.layerId}setVisible(t,e,r){super.setVisible(t,e,r),r?(this.animateSymbol.stopAnimation(),this.animateSymbol.symbol.hide()):(this.animateSymbol.symbol.show(),this.animateSymbol.startAnimation())}removeLayer(t,e){this.animateSymbol.remove(),super.removeLayer(t,e)}}class Jt extends x{constructor(){super();b(this,"animateFill")}async addLayer(t,e){var n;super.addLayer(t,e);let r=t.getSourceData(e.sourceId),i=await this.createAnimateImages(t,e),a={...e};delete a.layerId,delete a.sourceId,this.animateFill=u.default.createAnimateFillLayer(t,r,{animateImages:i,speed:(n=e.speed)!=null?n:1,...a})}getLayerId(){return this.animateFill.layerId}setVisible(t,e,r){super.setVisible(t,e,r),r?(this.animateFill.stopAnimation(),this.animateFill.polygon.hide()):(this.animateFill.polygon.show(),this.animateFill.startAnimation())}removeLayer(t,e){this.animateFill.remove(),super.removeLayer(t,e)}}class Yt extends x{constructor(){super();b(this,"sourceId");b(this,"events");this.events=[]}async createCluster(t,e){var h,f,g,d,m;this.sourceId="cluster-points"+u.default.RandomID();let r=t.getSourceData(e.sourceId);t.addSource(this.sourceId,{type:"geojson",data:r,cluster:!0,clusterMaxZoom:(h=e.clusterMaxZoom)!=null?h:10,clusterRadius:(f=e.clusterRadius)!=null?f:60});let i=(g=e.outerColors)!=null?g:[[1e3,"rgba(253, 156, 115, 0.6)"],[100,"rgba(241, 211, 87, 0.6)"],[0,"rgba(181, 226, 140, 0.6)"]];i.forEach((y,A)=>{var L;t.addLayer({id:"point-outer-cluster-"+this.sourceId+A,type:"circle",source:this.sourceId,paint:{"circle-color":y[1],"circle-radius":(L=e.outerCircleRadius)!=null?L:20},filter:A===0?[">=","point_count",y[0]]:["all",[">=","point_count",y[0]],["<","point_count",i[A-1][0]]]})});let a=(d=e.innerColors)!=null?d:[[1e3,"rgba(241, 128, 23, 0.6)"],[100,"rgba(240, 194, 12, 0.6)"],[0,"rgba(110, 204, 57, 0.6)"]];a.forEach((y,A)=>{var L;t.addLayer({id:"point-inner-cluster-"+this.sourceId+A,type:"circle",source:this.sourceId,paint:{"circle-color":y[1],"circle-radius":(L=e.innerCircleRadius)!=null?L:15},filter:A===0?[">=","point_count",y[0]]:["all",[">=","point_count",y[0]],["<","point_count",a[A-1][0]]]})}),t.addLayer({id:"cluster-count"+this.sourceId,type:"symbol",source:this.sourceId,filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["simsun"],"text-size":(m=e.clusterTextSize)!=null?m:12}}),t.addLayer({...t.properties({...e}),id:"unclustered-point"+this.sourceId,type:"symbol",source:this.sourceId,filter:["!",["has","point_count"]]});for(let y=0;y<i.length;y++){let A="point-outer-cluster-"+this.sourceId+y;const L=v=>{var k;let w=t.queryRenderedFeatures(v.point,{layers:[A]}),S=w[0].properties.cluster_id;(k=t.getSource(this.sourceId))==null||k.getClusterExpansionZoom(S,(T,I)=>{T||t.easeTo({center:w[0].geometry.coordinates,zoom:I})})};t.on("click",A,L),this.events.push(["click",A,L]);const D=v=>{t.getCanvas().style.cursor="pointer"};t.on("mouseenter",A,D),this.events.push(["mouseenter",A,D]);const C=v=>{t.getCanvas().style.cursor=""};t.on("mouseleave",A,C),this.events.push(["mouseleave",A,C])}const n=y=>{var L;let A=y.features[0].geometry.coordinates.slice();if(y.features[0].properties.index,e.popupHtml){let D=new u.default.Popup({offset:(L=e.popupOffset)!=null?L:[0,0],anchor:e.popupAnchor,closeButton:e.closeButton,closeOnClick:e.closeOnClick,closeOnMove:e.closeOnMove,focusAfterOpen:e.focusAfterOpen,className:e.className,maxWidth:e.maxWidth});D.setLngLat(A);let C=e.popupHtml,v=this.evalValue("return `"+C+"`",y.features[0].properties,this.map);D.setHTML(v).addTo(t)}};t.on("click","unclustered-point"+this.sourceId,n),this.events.push(["click","unclustered-point"+this.sourceId,n]);const l=()=>{t.getCanvas().style.cursor="pointer"};t.on("mouseenter","unclustered-point"+this.sourceId,l),this.events.push(["mouseenter","unclustered-point"+this.sourceId,l]);const c=()=>{t.getCanvas().style.cursor=""};t.on("mouseleave","unclustered-point"+this.sourceId,c),this.events.push(["mouseleave","unclustered-point"+this.sourceId,c])}async addLayer(t,e){super.addLayer(t,e),this.createCluster(t,e)}setVisible(t,e,r){super.setVisible(t,e,r),r?t.hideSource(this.sourceId):t.showSource(this.sourceId)}removeLayer(t,e){if(this.events){for(let r of this.events)t.off(r[0],r[1],r[1]);this.events=[]}t.removeSourceEx(this.sourceId),super.removeLayer(t,e)}}class Qt extends x{constructor(){super();b(this,"markerCluster");b(this,"popupInfo");this.popupInfo=null}getColor(t,e,r){t=t!=null?t:[[0,"#00FFFF","#00FFFF"],[5,"#F0F","#80FF00"],[10,"#00F","#FFFF00"],[1e3,"#FFF","#FF3D3D"]];for(let i=0;i<t.length;i++)if(e<=t[i][0])return r?t[i][1]:t[i][2];return t.length==0?"#00FFFF":r?t[t.length-1][1]:t[t.length-1][2]}async addLayer(t,e){var c,h,f,g;super.addLayer(t,e);let i=t.getSourceData(e.sourceId).features,a=[];for(let d=0;d<i.length;d++){let m=i[d].geometry;if(m.type=="Point"&&a.push({point:t.fromLngLat(m.coordinates),properties:{...i[d].properties}}),e.isDrawLinePoint){let y=[];m.type=="LineString"?y=m.coordinates:m.type=="Polygon"&&(y=m.coordinates[0]);for(let A of y)a.push({point:t.fromLngLat(A),properties:{...i[d].properties}})}}const n=(d,m)=>{if(m.length<=1){let y={...e};y=this.evalValue(y,d.properties,this.map);let A=new u.default.Marker({...e,color:this.getColor(y.textColors,m.length)}).setLngLat(this.map.toLngLat(d.point));return y.popupHtml&&A.on("click",L=>{var v;this.popupInfo?this.popupInfo.remove():this.popupInfo=new u.default.Popup({offset:(v=y.popupOffset)!=null?v:[0,0],anchor:y.popupAnchor,closeButton:y.closeButton,closeOnClick:y.closeOnClick,closeOnMove:y.closeOnMove,focusAfterOpen:y.focusAfterOpen,className:y.className,maxWidth:y.maxWidth});let D=y.popupHtml,C=this.evalValue("return `"+D+"`",A.clusterMarkersData[0].properties,this.map);this.popupInfo.setHTML(C),this.popupInfo.setLngLat(A.getLngLat()).addTo(this.map)}),A}else{let y=new u.default.Text({text:m.length+"",anchor:"center",offset:[0,0],style:{"background-color":this.getColor(e.textColors,m.length),color:this.getColor(e.textColors,m.length,!0),...e.textStyle}});return y.setLngLat(this.map.toLngLat(d.point)).addTo(this.map),y.on("click",A=>{if(y.clusterMarkersData.length===1)return;let L=y.clusterMarkersData.map(v=>v.point),D=u.default.geoBounds();D.update(L);let C=this.map.toLngLat(D);this.map.fitBounds(C,{padding:40})}),y}},l=(d,m,y)=>{if(y instanceof u.default.Text)if(m.length>1)y.setText(m.length+"");else return y.remove(),n(d,m);else if(m.length>1)return y.remove(),n(d,m)};this.markerCluster=new u.default.MarkerCluster({data:a,createMarker:n,updateMarker:l,allowOverlap:(c=e.allowOverlap)!=null?c:!1,allowOverlapMaxZoom:(h=e.allowOverlapMaxZoom)!=null?h:4,markerWidth:(f=e.markerWidth)!=null?f:28,markerHeight:(g=e.markerHeight)!=null?g:40}),this.markerCluster.addTo(t)}setLayerStyle(t,e,r,i){super.setLayerStyle(t,e,r,i),this.removeLayer(t,e),this.addLayer(t,P(i,r))}setVisible(t,e,r){super.setVisible(t,e,r),r?this.markerCluster.hide():this.markerCluster.show()}removeLayer(t,e){this.markerCluster.remove(),this.popupInfo&&(this.popupInfo.remove(),this.popupInfo=null),super.removeLayer(t,e)}}class qt extends x{constructor(){super();b(this,"texts")}createText(t,e,r,i){var c;r=this.evalValue(r,e,i);let a=r.text||"",n=this.evalValue("return `"+a+"`",e,i),l=new u.default.Text({...r,text:n});if(this.setMarkerOptions(l,r),l.setLngLat(t).addTo(i),r.animationType&&l.setAnimation(r.animationType),r.popupHtml){let h=new u.default.Popup({offset:(c=r.popupOffset)!=null?c:[0,0],anchor:r.popupAnchor,closeButton:r.closeButton,closeOnClick:r.closeOnClick,closeOnMove:r.closeOnMove,focusAfterOpen:r.focusAfterOpen,className:r.className,maxWidth:r.maxWidth}),f=r.popupHtml,g=this.evalValue("return `"+f+"`",e,i);h.setHTML(g),l.setPopup(h)}this.texts=this.texts||[],this.texts.push(l)}async addLayer(t,e){super.addLayer(t,e);let i=t.getSourceData(e.sourceId).features;for(let a=0;a<i.length;a++){let n=i[a].geometry;if(n.type=="Point"&&this.createText(n.coordinates,i[a].properties,e,t),e.isDrawLinePoint){let l=[];n.type=="LineString"?l=n.coordinates:n.type=="Polygon"&&(l=n.coordinates[0]);for(let c of l)this.createText(c,i[a].properties,e,t)}}}setVisible(t,e,r){super.setVisible(t,e,r);for(let i of this.texts)r?i.hide():i.show()}removeLayer(t,e){if(!!this.texts){for(let r of this.texts)r.remove();this.texts=[],super.removeLayer(t,e)}}}class Xt extends x{constructor(){super();b(this,"markers")}createMarker(t,e,r,i){r=this.evalValue(r,e,i);let a=r.text||"",n=this.evalValue("return `"+a+"`",e,i),l=new u.default.BreathingApertureMarker({lngLat:t,text:n},{...r,colors:[r.color1,r.color2],height:r.markerHeight}).createMarker();l.addTo(i),this.setMarkerOptions(l,r),this.markers=this.markers||[],this.markers.push(l)}async addLayer(t,e){super.addLayer(t,e);let i=t.getSourceData(e.sourceId).features;for(let a=0;a<i.length;a++){let n=i[a].geometry;if(n.type=="Point"&&this.createMarker(n.coordinates,i[a].properties,e,t),e.isDrawLinePoint){let l=[];n.type=="LineString"?l=n.coordinates:n.type=="Polygon"&&(l=n.coordinates[0]);for(let c of l)this.createMarker(c,i[a].properties,e,t)}}}setVisible(t,e,r){super.setVisible(t,e,r);for(let i of this.markers)i.setVisible(!r,!0)}removeLayer(t,e){if(!!this.markers){for(let r of this.markers)r.remove();this.markers=[],super.removeLayer(t,e)}}}class $t extends x{constructor(){super();b(this,"markers")}createMarker(t,e,r,i){r=this.evalValue(r,e,i);let a=r.text||"",n=this.evalValue("return `"+a+"`",e,i),l=new u.default.RotatingApertureMarker({lngLat:t,text:n},{...r,colors:[r.color1,r.color2],height:r.markerHeight}).createMarker();l.addTo(i),this.setMarkerOptions(l,r),this.markers=this.markers||[],this.markers.push(l)}async addLayer(t,e){super.addLayer(t,e);let i=t.getSourceData(e.sourceId).features;for(let a=0;a<i.length;a++){let n=i[a].geometry;if(n.type=="Point"&&this.createMarker(n.coordinates,i[a].properties,e,t),e.isDrawLinePoint){let l=[];n.type=="LineString"?l=n.coordinates:n.type=="Polygon"&&(l=n.coordinates[0]);for(let c of l)this.createMarker(c,i[a].properties,e,t)}}}setVisible(t,e,r){super.setVisible(t,e,r);for(let i of this.markers)i.setVisible(!r,!0)}removeLayer(t,e){if(!!this.markers){for(let r of this.markers)r.remove();this.markers=[],super.removeLayer(t,e)}}}class er extends x{constructor(){super();b(this,"markers")}createMarker(t,e,r,i){r=this.evalValue(r,e,i);let a=r.text||"",n=this.evalValue("return `"+a+"`",e,i),l=new u.default.HaloRingMarker({lngLat:t,text:n},{...r,colors:[r.color1,r.color2],height:r.markerHeight}).createMarker();l.addTo(i),this.setMarkerOptions(l,r),this.markers=this.markers||[],this.markers.push(l)}async addLayer(t,e){super.addLayer(t,e);let i=t.getSourceData(e.sourceId).features;for(let a=0;a<i.length;a++){let n=i[a].geometry;if(n.type=="Point"&&this.createMarker(n.coordinates,i[a].properties,e,t),e.isDrawLinePoint){let l=[];n.type=="LineString"?l=n.coordinates:n.type=="Polygon"&&(l=n.coordinates[0]);for(let c of l)this.createMarker(c,i[a].properties,e,t)}}}setVisible(t,e,r){super.setVisible(t,e,r);for(let i of this.markers)i.setVisible(!r,!0)}removeLayer(t,e){if(!!this.markers){for(let r of this.markers)r.remove();this.markers=[],super.removeLayer(t,e)}}}class tr extends x{constructor(){super();b(this,"markers")}createMarker(t,e,r,i){r=this.evalValue(r,e,i);let a=r.text||"",n=this.evalValue("return `"+a+"`",e,i),l=new u.default.DiffusedApertureMarker({lngLat:t,text:n},{...r,colors:[r.color1,r.color2],height:r.markerHeight}).createMarker();l.addTo(i),this.setMarkerOptions(l,r),this.markers=this.markers||[],this.markers.push(l)}async addLayer(t,e){super.addLayer(t,e);let i=t.getSourceData(e.sourceId).features;for(let a=0;a<i.length;a++){let n=i[a].geometry;if(n.type=="Point"&&this.createMarker(n.coordinates,i[a].properties,e,t),e.isDrawLinePoint){let l=[];n.type=="LineString"?l=n.coordinates:n.type=="Polygon"&&(l=n.coordinates[0]);for(let c of l)this.createMarker(c,i[a].properties,e,t)}}}setVisible(t,e,r){super.setVisible(t,e,r);for(let i of this.markers)i.setVisible(!r,!0)}removeLayer(t,e){if(!!this.markers){for(let r of this.markers)r.remove();this.markers=[],super.removeLayer(t,e)}}}class rr extends x{constructor(){super();b(this,"markers")}createMarker(t,e,r,i){r=this.evalValue(r,e,i);let a=r.text||"",n=this.evalValue("return `"+a+"`",e,i),l=new u.default.RotatingTextBorderMarker({lngLat:t,text:n},{...r,colors:[r.color1,r.color2],height:r.markerHeight}).createMarker();l.addTo(i),this.setMarkerOptions(l,r),this.markers=this.markers||[],this.markers.push(l)}async addLayer(t,e){super.addLayer(t,e);let i=t.getSourceData(e.sourceId).features;for(let a=0;a<i.length;a++){let n=i[a].geometry;if(n.type=="Point"&&this.createMarker(n.coordinates,i[a].properties,e,t),e.isDrawLinePoint){let l=[];n.type=="LineString"?l=n.coordinates:n.type=="Polygon"&&(l=n.coordinates[0]);for(let c of l)this.createMarker(c,i[a].properties,e,t)}}}setVisible(t,e,r){super.setVisible(t,e,r);for(let i of this.markers)i.setVisible(!r,!0)}removeLayer(t,e){if(!!this.markers){for(let r of this.markers)r.remove();this.markers=[],super.removeLayer(t,e)}}}class sr extends x{constructor(){super();b(this,"markers")}createMarker(t,e,r,i){r=this.evalValue(r,e,i);let a=r.text||"",n=this.evalValue("return `"+a+"`",e,i),l=new u.default.FluorescenceMarker({lngLat:t,text:n},{...r,colors:[r.color1,r.color2],height:r.markerHeight}).createMarker();l.addTo(i),this.setMarkerOptions(l,r),this.markers=this.markers||[],this.markers.push(l)}async addLayer(t,e){super.addLayer(t,e);let i=t.getSourceData(e.sourceId).features;for(let a=0;a<i.length;a++){let n=i[a].geometry;if(n.type=="Point"&&this.createMarker(n.coordinates,i[a].properties,e,t),e.isDrawLinePoint){let l=[];n.type=="LineString"?l=n.coordinates:n.type=="Polygon"&&(l=n.coordinates[0]);for(let c of l)this.createMarker(c,i[a].properties,e,t)}}}setVisible(t,e,r){super.setVisible(t,e,r);for(let i of this.markers)i.setVisible(!r,!0)}removeLayer(t,e){if(!!this.markers){for(let r of this.markers)r.remove();this.markers=[],super.removeLayer(t,e)}}}class ir extends x{constructor(){super();b(this,"polyline")}async addLayer(t,e){super.addLayer(t,e);let r=t.getSourceData(e.sourceId),i=[],a=r.features;for(let l=0;l<a.length;l++){let c=a[l].geometry;if(c.type!="LineString")continue;let h=c.coordinates;if(c.coordinates.length>2){const f=u.default.polylineToBezierCurve(t.fromLngLat(c.coordinates).map(g=>[g.x,g.y]));h=u.default.bezierCurveToPolyline(f),i.push({points:t.toLngLat(h),properties:c.properties})}else i.push({points:h,properties:c.properties})}let n={...e};delete n.layerId,delete n.sourceId,this.polyline=new u.default.Polyline({data:i,...n}),this.polyline.addTo(t,e.before)}getLayerId(){return this.polyline.layerId}setLayerStyle(t,e,r,i){super.setLayerStyle(t,e,r,i),this.removeLayer(t,e),this.addLayer(t,P(i,r))}setVisible(t,e,r){super.setVisible(t,e,r),r?this.polyline.hide():this.polyline.show()}removeLayer(t,e){this.polyline&&this.polyline.remove(),super.removeLayer(t,e)}}class or extends x{constructor(){super();b(this,"fillExtrusion");b(this,"anim")}async addLayer(t,e){var l,c;super.addLayer(t,e);let r=t.getSourceData(e.sourceId),i=[],a=r.features;for(let h=0;h<a.length;h++){let f=a[h].geometry,g=[];if(f.type=="LineString")g.push(f.coordinates);else if(f.type=="MultiLineString")g.push(...f.coordinates);else continue;if(e.isBreakLine){let d=[];for(let m of g){for(let y=0;y<m.length-1;y++)d.push([m[y],m[y+1]]);g=d}}for(const d of g){let m=t.fromLngLat(d),y=u.default.polylineMarginToPolygon(m,{offset:(l=e.offsetLine)!=null?l:10});i.push({points:t.toLngLat(y),properties:{...f.properties,path:y}})}}let n={...e};if(delete n.layerId,delete n.sourceId,this.fillExtrusion=new u.default.FillExtrusion({data:i,...n}),this.fillExtrusion.addTo(t,e.before),e.anmiDuration){const h=u.default.cloneDeep(this.fillExtrusion.getData());this.anim=u.default.createAnimation({from:0,to:1,repeatType:(c=e.anmiRepeatType)!=null?c:"reverse",repeat:e.anmiRepeat||1/0,duration:e.anmiDuration*1e3,ease:u.default.linear,onUpdate:f=>{var d;const g=this.fillExtrusion.getData();for(let m=0;m<g.features.length;m++){const y=f,A=h.features[m].properties,L=u.default.interpolatePointsByRatio(A.path,y);if(L.length>1){const D=u.default.polylineMarginToPolygon(L,{offset:(d=e.offsetLine)!=null?d:10}),C=u.default.createPolygonGeoJson(t.toLngLat(D));C.features[0]&&C.features[0].geometry&&(g.features[m].geometry.coordinates=C.features[0].geometry.coordinates)}}this.fillExtrusion.setData(g)}})}}setLayerStyle(t,e,r,i){super.setLayerStyle(t,e,r,i),this.removeLayer(t,e),this.addLayer(t,P(i,r))}setVisible(t,e,r){super.setVisible(t,e,r),r?(this.fillExtrusion.hide(),this.anim&&this.anim.stop()):(this.fillExtrusion.show(),this.anim&&this.anim.start())}removeLayer(t,e){this.fillExtrusion&&this.fillExtrusion.remove(),this.anim&&(this.anim.stop(),this.anim=null),super.removeLayer(t,e)}}class ar extends x{constructor(){super();b(this,"polylineArrows")}async addLayer(t,e){super.addLayer(t,e),this.polylineArrows=this.polylineArrows||[];let i=t.getSourceData(e.sourceId).features;for(let a=0;a<i.length;a++){let n=i[a].geometry;if(n.type!="LineString")continue;await t.onLoad(!0);let l=n.coordinates,c=this.evalValue(e,i[a].properties,t);delete c.layerId,delete c.sourceId;let h=new u.default.PolylineArrow({...c,path:l});h.addTo(t,e.before),this.polylineArrows.push(h)}}getLayerId(){return this.polylineArrows.map(t=>t.id)}setLayerStyle(t,e,r,i){super.setLayerStyle(t,e,r,i),this.removeLayer(t,e),this.addLayer(t,P(i,r))}setVisible(t,e,r){if(super.setVisible(t,e,r),this.polylineArrows&&this.polylineArrows.length)for(let i of this.polylineArrows)r?i.hide():i.show()}removeLayer(t,e){if(this.polylineArrows&&this.polylineArrows.length){for(let r of this.polylineArrows)r.remove();this.polylineArrows=[]}super.removeLayer(t,e)}}class nr extends x{constructor(){super();b(this,"polylineArrows");b(this,"symbolSourcedIds");b(this,"anims")}async addLayer(t,e){super.addLayer(t,e),this.polylineArrows=this.polylineArrows||[],this.symbolSourcedIds=this.symbolSourcedIds||[],this.anims=this.anims||[];let i=t.getSourceData(e.sourceId).features;for(let a=0;a<i.length;a++){let n=i[a].geometry;if(n.type!="LineString")continue;await t.onLoad(!0);let l=n.coordinates,c=this.evalValue(e,i[a].properties,t);delete c.layerId,delete c.sourceId;let h=new u.default.PolylineArrow({...c,path:l});h.addTo(t,e.before),this.polylineArrows.push(h);let f;if(e.iconImage){let m=Object.keys(e).filter(L=>L.indexOf("symbol")==0||L.indexOf("icon")==0||L.indexOf("text")==0),y={};for(let L of m)y[L]=e[L];let A=u.default.RandomID();f="path_animi_source_"+A,t.addGeoJSONSource(f),t.addSymbolLayer("path_animi_layer_"+A,f,{iconRotate:["get","bearing"],iconRotationAlignment:"map",iconAllowOverlap:!0,iconIgnorePlacement:!0,...y}),this.symbolSourcedIds.push(f)}let g=c.fps||10;const d=h.animate(100,g,!0,m=>{},(m,y)=>{if(m!==u.default.FrameAnimationStatus.Run||!f)return;const A=u.default.geoPoint(y.endPnt).angleTo(u.default.geoPoint(y.startPnt)),L=u.default.createPointGeoJson({point:y.endPnt,properties:{...i[a].properties,bearing:u.default.radToDeg(-A)}});t.setData(f,L)});this.anims.push(d)}}setLayerStyle(t,e,r,i){super.setLayerStyle(t,e,r,i),this.removeLayer(t,e),this.addLayer(t,P(i,r))}setVisible(t,e,r){if(super.setVisible(t,e,r),this.anims&&this.anims.length)for(let i of this.anims)r?i.stop():i.start();if(this.polylineArrows&&this.polylineArrows.length){for(let i of this.polylineArrows)r?i.hide():i.show();for(let i of this.symbolSourcedIds)r?t.hideSource(i):t.showSource(i)}}removeLayer(t,e){if(this.anims&&this.anims.length){for(let r of this.anims)r.stop();this.anims=[]}if(this.polylineArrows&&this.polylineArrows.length){for(let r of this.polylineArrows)r.remove();this.polylineArrows=[]}if(this.symbolSourcedIds&&this.symbolSourcedIds.length){for(let r of this.symbolSourcedIds)t.removeSourceEx(r);this.symbolSourcedIds=[]}super.removeLayer(t,e)}}class lr extends x{constructor(){super();b(this,"line");b(this,"symbol");b(this,"anim")}async addLayer(t,e){var g;super.addLayer(t,e);let i=t.getSourceData(e.sourceId).features,a=[],n=[];for(let d=0;d<i.length;d++){let m=i[d].geometry;if(m.type!="LineString")continue;let y=t.fromLngLat(m.coordinates);e.drawPath&&n.push({points:t.toLngLat(y),properties:{...i[d].properties}});const A=u.default.geoPoint(y[1]).angleTo(u.default.geoPoint(y[0]));a.push({point:t.toLngLat(y[0]),properties:{...i[d].properties,bearing:u.default.radToDeg(-A),path:y}})}if(n.length>0){let d=Object.keys(e).filter(y=>y.indexOf("line")==0),m={};for(let y of d)m[y]=e[y];this.line=new u.default.Polyline({data:n,...m}),this.line.addTo(t)}let l=Object.keys(e).filter(d=>d.indexOf("symbol")==0||d.indexOf("icon")==0||d.indexOf("text")==0),c={};for(let d of l)c[d]=e[d];this.symbol=new u.default.Symbol({data:a,iconAllowOverlap:!0,iconRotationAlignment:"map",...c,iconRotate:["get","bearing"]}),this.symbol.addTo(t,e.before);const h=u.default.cloneDeep(this.symbol.getData());let f=0;this.anim=u.default.createAnimation({from:0,to:1,repeatType:(g=e.anmiRepeatType)!=null?g:"reverse",repeat:e.anmiRepeat||1/0,duration:e.anmiDuration*1e3,ease:u.default.linear,onUpdate:d=>{let m=f>d;f=d;const y=this.symbol.getData();for(let A=0;A<y.features.length;A++){const L=d,D=h.features[A].properties,C=u.default.interpolatePointsByRatio(D.path,L);if(C.length>1){let v=C[C.length-2],w=C[C.length-1],S=0;m?S=u.default.geoPoint(v).angleTo(u.default.geoPoint(w)):S=u.default.geoPoint(w).angleTo(u.default.geoPoint(v)),y.features[A].properties.bearing=u.default.radToDeg(-S);const k=u.default.createPointGeoJson(t.toLngLat(w));k.features[0]&&k.features[0].geometry&&(y.features[A].geometry.coordinates=k.features[0].geometry.coordinates)}}this.symbol.setData(y)}})}setLayerStyle(t,e,r,i){super.setLayerStyle(t,e,r,i),this.removeLayer(t,e),this.addLayer(t,P(i,r))}setVisible(t,e,r){super.setVisible(t,e,r),r?(this.anim.stop(),this.symbol.hide(),this.line&&this.line.hide()):(this.line&&this.line.show(),this.symbol.show(),this.anim.start())}removeLayer(t,e){this.anim.stop(),this.symbol.remove(),this.line&&this.line.remove(),super.removeLayer(t,e)}}class ur extends x{constructor(){super();b(this,"fillExtrusion");b(this,"anim")}async addLayer(t,e){var l;super.addLayer(t,e);let r=t.getSourceData(e.sourceId),i=[],a=r.features;for(let c=0;c<a.length;c++){let h=a[c].geometry;h.type=="Polygon"&&i.push({points:h.coordinates,properties:{...h.properties}})}let n={...e};if(delete n.layerId,delete n.sourceId,this.fillExtrusion=new u.default.FillExtrusion({data:i,...n,fillExtrusionHeight:["get","height"]}),this.fillExtrusion.addTo(t,e.before),e.anmiDuration){const c=u.default.cloneDeep(this.fillExtrusion.getData()),h=f=>u.default.interpolate([0,1],[{height:0},{height:c.features[f].properties.height||5e5}]);this.anim=u.default.createAnimation({from:0,to:1,repeatType:(l=e.anmiRepeatType)!=null?l:"loop",repeat:e.anmiRepeat||1/0,duration:e.anmiDuration*1e3,onUpdate:f=>{const g=this.fillExtrusion.getData();for(let d=0;d<g.features.length;d++){const m=h(d)(f);g.features[d].properties.height=m.height}this.fillExtrusion.setData(g)}})}}setLayerStyle(t,e,r,i){super.setLayerStyle(t,e,r,i),this.removeLayer(t,e),this.addLayer(t,P(i,r))}setVisible(t,e,r){super.setVisible(t,e,r),r?(this.fillExtrusion.hide(),this.anim&&this.anim.stop()):(this.fillExtrusion.show(),this.anim&&this.anim.start())}removeLayer(t,e){this.fillExtrusion&&this.fillExtrusion.remove(),this.anim&&(this.anim.stop(),this.anim=null),super.removeLayer(t,e)}}class cr extends x{constructor(){super();b(this,"sourceId")}async addLayer(t,e){super.addLayer(t,e);let r=t.getSourceData(e.sourceId),i="geojson_source_"+u.default.RandomID();this.sourceId=i,t.addGeoJSONSource(i,r);let a=Object.keys(e).filter(g=>g.indexOf("fill")==0),n={};for(let g of a)n[g]=e[g];t.addFillLayer(i+"-layer-polygons",i,{source:i,...n,filter:["==",["geometry-type"],"Polygon"]});let l=Object.keys(e).filter(g=>g.indexOf("line")==0),c={};for(let g of l)c[g]=e[g];t.addLineLayer(i+"-layer-lines",i,{source:i,...c,filter:["==",["geometry-type"],"LineString"]});let h=Object.keys(e).filter(g=>g.indexOf("circle")==0),f={};for(let g of h)f[g]=e[g];t.addCircleLayer(i+"-layer-points",i,{source:i,...f,filter:["==",["geometry-type"],"Point"]})}setLayerStyle(t,e,r,i){super.setLayerStyle(t,e,r,i),this.removeLayer(t,e),this.addLayer(t,P(i,r))}setVisible(t,e,r){super.setVisible(t,e,r),this.sourceId&&(r?t.hideSource(this.sourceId):t.showSource(this.sourceId))}removeLayer(t,e){this.sourceId&&(t.removeSourceEx(this.sourceId),this.sourceId=void 0),super.removeLayer(t,e)}}class dr extends x{constructor(){super();b(this,"draw");b(this,"sourceID")}async addLayer(t,e){super.addLayer(t,e),this.sourceID=e.sourceId;let r=t.getSourceData(e.sourceId);const i=u.default.cloneDeep(u.default.Draw.defaultOptions());i.isActionDrawMode=!0,this.draw=new u.default.Draw.Tool(i),t.addControl(this.draw,"top-right"),this.draw.set(r)}setVisible(t,e,r){if(super.setVisible(t,e,r),!!this.draw)if(r)this.draw.set({type:"FeatureCollection",features:[]});else{let i=t.getSourceData(this.sourceID);this.draw.set(i)}}removeLayer(t,e){this.draw&&(this.map.removeControl(this.draw),this.draw=null),super.removeLayer(t,e)}}class fr extends x{constructor(){super()}async addLayer(s,t){super.addLayer(s,t),s.addRasterLayer(t.layerId,t.sourceId,t,t.before)}setVisible(s,t,e){super.setVisible(s,t,e),e?s.hide(t):s.show(t)}removeLayer(s,t){s.removeLayerEx(t),super.removeLayer(s,t)}}class hr extends x{constructor(){super();b(this,"layers")}async addLayer(t,e){super.addLayer(t,e);const r=t.getService().vectorStyle();this.layers=r.layers;for(let i of this.layers)i.source=e.sourceId,i.id=i.id.replace("vector-",e.layerId+"-"),t.addLayer(i)}setVisible(t,e,r){if(super.setVisible(t,e,r),r)for(let i of this.layers)t.hide(i.id);else for(let i of this.layers)t.show(i.id)}removeLayer(t,e){for(let r of this.layers)t.removeLayerEx(r.id);super.removeLayer(t,e)}}class gr extends x{constructor(){super();b(this,"overlay")}createDivOverlay(t,e,r){let i=this.evalValue(e,t,r);if(!!i.bounds&&!!i.width&&!!i.height){if(Array.isArray(i.bounds)&&i.bounds.length==2&&(i.bounds=new u.default.GeoBounds(u.default.geoPoint(i.bounds[0]),u.default.geoPoint(i.bounds[1]))),i.customHtml){let a=this.evalValue(e.customHtml,t,r);i.element=a}else if(i.customImage){i.customImage.toLowerCase().indexOf("<svg")==0&&(i.customImage="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(e.customImage))));const a=document.createElement("img");a.style.position="absolute",a.style.left="0px",a.style.top="0px",a.style.width=i.width+"px",a.style.height=i.height+"px",a.src=i.customImage,a.style.pointerEvents="none",i.element=a}!i.element||(this.overlay=new u.default.DivOverlay(i),this.overlay.addTo(r))}}async addLayer(t,e){super.addLayer(t,e),this.createDivOverlay({},e,t)}setVisible(t,e,r){super.setVisible(t,e,r),this.overlay&&this.overlay.setVisible(!r)}removeLayer(t,e){this.overlay&&this.overlay.remove(),super.removeLayer(t,e)}}class yr extends x{constructor(){super();b(this,"overlay")}async addLayer(t,e){super.addLayer(t,e),this.overlay=new u.default.SvgOverlay(e),this.overlay.addTo(t)}setVisible(t,e,r){super.setVisible(t,e,r),this.overlay&&this.overlay.divOverlay&&this.overlay.divOverlay.setVisible(!r)}removeLayer(t,e){this.overlay&&this.overlay.remove(),super.removeLayer(t,e)}}class mr extends x{constructor(){super();b(this,"background")}async addLayer(t,e){super.addLayer(t,e),this.background=new u.default.BackgroundLayer(e),this.background.addTo(t,e.before)}setVisible(t,e,r){super.setVisible(t,e,r),r?this.background.hide():this.background.show()}removeLayer(t,e){t.removeLayerEx(e),super.removeLayer(t,e)}}class pr extends x{constructor(){super();b(this,"sky")}async addLayer(t,e){super.addLayer(t,e),this.sky=new u.default.SkyLayer(e),this.sky.addTo(t,e.before)}setVisible(t,e,r){super.setVisible(t,e,r),r?this.sky.hide():this.sky.show()}removeLayer(t,e){t.removeLayerEx(e),super.removeLayer(t,e)}}const xe={line:jt,fill:Nt,symbol:Ht,marker:Ut,popup:_t,circle:Gt,fillExtrusion:Wt,heatmap:zt,animateLine:Zt,animateSymbol:Kt,animateFill:Jt,symbolCluster:Yt,markerCluster:Qt,text:qt,breathingMarker:Xt,rotatingMarker:$t,haloRingMarker:er,diffusedMarker:tr,textBorderMarker:rr,fluorescenceMarker:sr,curve:ir,lineExtrusions:or,arrowLine:ar,pathAnimate:nr,symbolPathAnimate:lr,fillExtrusionsAnimate:ur,geojson:cr,draw:dr,raster:fr,vector:hr,divOverlay:gr,svgOverlay:yr,background:mr,sky:pr},B=class{constructor({dbName:s,version:t,tables:e}){b(this,"dbName","");b(this,"version",1);b(this,"tableList",[]);b(this,"db",null);b(this,"queue",[]);this.dbName=s,this.version=t,this.tableList=e}static getInstance(s){var e,r;B._instance=(e=B._instance)!=null?e:{};const t=(r=s==null?void 0:s.dbName)!=null?r:"";return B._instance[t]||(B._instance[t]=new B(s)),B._instance[t]}queryAll({tableName:s}){const t=[];return this.commitDb(s,e=>e.openCursor(),"readonly",(e,r)=>{this.cursor_success(e,{condition:()=>!0,handler:({currentValue:i})=>t.push(i),success:()=>r(t)})})}query({tableName:s,condition:t}){const e=[];return this.commitDb(s,r=>r.openCursor(),"readonly",(r,i)=>{this.cursor_success(r,{condition:t,handler:({currentValue:a})=>e.push(a),success:()=>i(e)})})}query_by_keyValue({tableName:s,key:t,value:e}){return this.commitDb(s,r=>r.index(t).get(e),"readonly",(r,i)=>{i(r.target.result||null)})}query_by_primaryKey({tableName:s,value:t}){return this.commitDb(s,e=>e.get(t),"readonly",(e,r)=>{r(e.target.result||null)})}update({tableName:s,condition:t,handle:e}){const r=[];return this.commitDb(s,i=>i.openCursor(),"readwrite",(i,a)=>{this.cursor_success(i,{condition:t,handler:({currentValue:n,cursor:l})=>{const c=e(n);r.push(c),l.update(c)},success:()=>{a(r)}})})}update_by_primaryKey({tableName:s,value:t,handle:e}){return this.commitDb(s,r=>r.get(t),"readwrite",(r,i,a)=>{const n=r.target.result;if(!n){i(null);return}const l=e(n);a.put(l),i(l)})}insert({tableName:s,data:t}){return this.commitDb(s,void 0,"readwrite",(e,r,i)=>{t instanceof Array?t.forEach(a=>i.put(a)):i.put(t),r()})}delete({tableName:s,condition:t}){const e=[];return this.commitDb(s,r=>r.openCursor(),"readwrite",(r,i)=>{this.cursor_success(r,{condition:t,handler:({currentValue:a,cursor:n})=>{e.push(a),n.delete()},success:()=>{i(e)}})})}delete_by_primaryKey({tableName:s,value:t}){return this.commitDb(s,e=>e.delete(t),"readwrite",(e,r)=>{r()})}open_db(){return new Promise((s,t)=>{const e=window.indexedDB.open(this.dbName,this.version);e.onerror=r=>{t(r)},e.onsuccess=r=>{this.db=r.target.result;let i;for(;i=this.queue.pop();)i();s(this)},e.onupgradeneeded=r=>{this.tableList.forEach(i=>{this.create_table(r.target.result,i)})}})}close_db(){return new Promise((s,t)=>{try{if(!this.db){s("\u8BF7\u5F00\u542F\u6570\u636E\u5E93");return}this.db.close(),this.db=null,B._instance&&delete B._instance[this.dbName],s(!0)}catch(e){t(e)}})}delete_db(s){return new Promise((t,e)=>{const r=indexedDB.deleteDatabase(s);r.onerror=i=>{e(i)},r.onsuccess=i=>{t(i)}})}delete_table(s){return this.commitDb(s,t=>t.clear(),"readwrite",(t,e)=>{e()})}create_table(s,{tableName:t,option:e,indexs:r=[]}){if(!s.objectStoreNames.contains(t)){const i=s.createObjectStore(t,e);for(const{key:a,option:n}of r)i.createIndex(a,a,n)}}commitDb(s,t,e="readwrite",r){return new Promise((i,a)=>{const n=()=>{try{if(this.db){const l=this.db.transaction(s,e).objectStore(s);if(!t){r(null,i,l);return}const c=t(l);c.onsuccess=h=>{r?r(h,i,l):i(h)},c.onerror=h=>{a(h)}}else a(new Error("\u8BF7\u5F00\u542F\u6570\u636E\u5E93"))}catch(l){a(l)}};this.db?n():this.queue.push(n)})}cursor_success(s,{condition:t,handler:e,success:r}){const i=s.target.result;if(i){const a=i.value;t(a)&&e({cursor:i,currentValue:a}),i.continue()}else r()}};let _=B;b(_,"_instance",null);const Ie=({dbName:o,version:s=1,tables:t=[]})=>_.getInstance({dbName:o,version:s,tables:t}).open_db(),Te=o=>_.getInstance({dbName:o,version:1,tables:[]});class Fe{constructor(){b(this,"dbName");b(this,"tableName");b(this,"isInitDb");this.dbName="vjmapCache",this.tableName="cache",this.isInitDb=!1}async init(){this.isInitDb||(await Ie({dbName:this.dbName,version:1,tables:[{tableName:this.tableName,option:{keyPath:"id",autoIncrement:!0},indexs:[{key:"id",option:{unique:!0}},{key:"key"},{key:"value"}]}]}),this.isInitDb=!0)}getInst(){return Te(this.dbName)}async getAll(){return await this.init(),await this.getInst().queryAll({tableName:this.tableName})}async getRecordByKey(s){return await this.init(),await this.getInst().query({tableName:this.tableName,condition:t=>t.key===s})}async getValueByKey(s,t){const e=await this.getRecordByKey(s);if(e.length!=0)return t===!0?JSON.parse(e[0].value):e[0].value}async setValueByKey(s,t,e){return await this.upsert({key:s,value:e===!0?JSON.stringify(t,null,0):t})}async upsert(s){return await this.init(),(await this.getRecordByKey(s.key)).length==0?await this.getInst().insert({tableName:this.tableName,data:s}):await this.getInst().update({tableName:this.tableName,condition:e=>e.key===s.key,handle:e=>(e.value=s.value,e)})}async deleteRecord(s){return await this.init(),await this.getInst().delete({tableName:this.tableName,condition:t=>t.key===s})}async deleteTable(){return await this.init(),await this.getInst().delete_table(this.tableName)}async deleteDb(){return await this.init(),await this.getInst().delete_db(this.dbName)}toStringKey(s,t){return t=t!=null?t:"",t+JSON.stringify(s,null,0)}}const X=new Fe;async function ee(o,s,t){var g,d;let e=o.getService();const r={...s,...t,mapId:(g=e.currentMapParam())==null?void 0:g.mapid,version:(d=e.currentMapParam())==null?void 0:d.version,workspace:e.getCurWorkspaceName()};let i=await X.getValueByKey(X.toStringKey(r,"query_"),!0);if(i)return i;let a;const n=[];let l=0;const c=5e4;let h;for(s.bounds&&(h=u.default.GeoBounds.fromString(s.bounds).toArray());;){const m=await e.conditionQueryFeature({condition:s.condition,bounds:h,fields:"",includegeom:!0,realgeom:!0,isContains:s.isContains,beginpos:l,limit:c,...t});if(!m.result||(l+=c,n.push(...m.result||[]),n.length>=m.recordCount))break}a={result:n,recordCount:n.length};let f=de(o,a,s.coordType==1);return await X.setValueByKey(X.toStringKey(r,"query_"),f,!0),f}const H=o=>{const s=new Set(["id","isEnvelop","envelop","geojson","geom","isPoint","isline","points"]),t={};for(const e in o)s.has(e)||(t[e]=o[e]);return t};function de(o,s,t){const e={features:[],type:"FeatureCollection"};if(s&&s.result&&s.result.length>0)for(const i of s.result)if(t){if(i.geom&&i.geom.geometries){let a={id:i.id,type:"Feature",properties:H(i)};i.geom.geometries.length==1?a={...a,geometry:i.geom.geometries[0]}:a={...a,geometry:{geometries:i.geom.geometries,type:"GeometryCollection"}},e.features.push(a)}}else{const a=i.points||i.positon||i.location||i.origin||i.center;if(a){const l=a.split(";").map(c=>o.toLngLat(u.default.GeoPoint.fromString(c)));if(l.length==1){const c={type:"Feature",id:i.id,properties:H(i),geometry:{type:"Point",coordinates:l[0]}};e.features.push(c)}else if(l.length>1){const c={type:"Feature",id:i.id,properties:H(i),geometry:{type:"LineString",coordinates:l}};e.features.push(c)}}}return o.fromLngLat(e)}async function Z(o,s,t){let e;if(s.reqType=="SOURCE")s.fromSourceId&&(e=await t.getSourceData(s.fromSourceId));else{s.data&&typeof s.data=="string"&&(s.data=JSON.parse(s.data)),s.header&&typeof s.header=="string"&&(s.header=JSON.parse(s.header));let r={headers:{Accept:"application/json","Content-Type":"application/json",...s.header}};s.url&&(s.reqType=="POST"?e=await u.default.httpHelper.post(s.url,s.data,r):e=await u.default.httpHelper.get(s.url,s.data,r))}return s.processJS&&(e=await Pe(e,s.processJS,o,t)),e}const fe=o=>{let s={type:"FeatureCollection",features:[]};for(let t=0;t<o.length;t++){let e=o[t];Array.isArray(e)&&e.length==2&&typeof e[0]=="number"?s.features.push({type:"Feature",id:t+1,properties:{index:t+1},geometry:{type:"Point",coordinates:e}}):Array.isArray(e)&&Array.isArray(e[0])&&typeof e[0][0]=="number"?s.features.push({type:"Feature",id:t+1,properties:{index:t+1},geometry:{type:"LineString",coordinates:o[t]}}):Array.isArray(e)&&Array.isArray(e[0])&&Array.isArray(e[0][0])&&typeof e[0][0][0]=="number"&&s.features.push({type:"Feature",id:t+1,properties:{index:t+1},geometry:{type:"Polygon",coordinates:o[t]}})}return s};async function Pe(o,s,t,e){Array.isArray(o)&&(o=fe(o));const r=Object.getPrototypeOf(async function(){}).constructor,i=new r("data","vjmap","map","mapApp","utils",s),a={ProcessDataToFeatureCollection:de,convertArrayToGeoJson:fe};return await i(o,u.default,t,e,a)}const rt={scatterDot:(o,s={})=>{var r;const t=(r=s.size)!=null?r:100;return{width:t,height:t,data:new Uint8Array(t*t*4),onAdd:function(){let i=document.createElement("canvas");i.width=this.width,i.height=this.height,this.context=i.getContext("2d")},render:function(){var f,g;const i=(f=s.duration)!=null?f:1500,a=(g=s.rgb)!=null?g:[0,150,0];let n=performance.now()%i/i,l=t/2*.3,c=t/2*.7*n+l,h=this.context;return h.clearRect(0,0,this.width,this.height),h.beginPath(),h.arc(this.width/2,this.height/2,c,0,Math.PI*2),h.fillStyle="rgba("+a[0]+","+a[1]+","+a[2]+","+(1-n)+" )",h.fill(),h.beginPath(),h.arc(this.width/2,this.height/2,l,0,Math.PI*2),this.data=h.getImageData(0,0,this.width,this.height).data,o.triggerRepaint(),!0}}},pulsingDot:(o,s={})=>{var r;const t=(r=s.size)!=null?r:100;return{width:t,height:t,data:new Uint8Array(t*t*4),onAdd:function(){const i=document.createElement("canvas");i.width=this.width,i.height=this.height,this.context=i.getContext("2d")},render:function(){var g,d,m,y,A,L,D;const i=(g=s.duration)!=null?g:1e3,a=performance.now()%i/i,n=(d=s.outFillRgb)!=null?d:[255,200,200],l=(m=s.innerFillRgb)!=null?m:[255,100,100],c=t/2*((y=s.innerRadiusRatio)!=null?y:.3),h=t/2*((A=s.outerRadiusRatio)!=null?A:.7)*a+c,f=this.context;return f.clearRect(0,0,this.width,this.height),f.beginPath(),f.arc(this.width/2,this.height/2,h,0,Math.PI*2),f.fillStyle="rgba("+n[0]+","+n[1]+","+n[2]+","+(1-a)+" )",f.fill(),f.beginPath(),f.arc(this.width/2,this.height/2,c,0,Math.PI*2),f.fillStyle="rgba("+l[0]+","+l[1]+","+l[2]+",1)",f.strokeStyle=(L=s.innerStrokeStyle)!=null?L:"white",f.lineWidth=2+((D=s.innerLineWidth)!=null?D:4)*(1-a),f.fill(),f.stroke(),this.data=f.getImageData(0,0,this.width,this.height).data,o.triggerRepaint(),!0}}}},st=()=>["https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],Ee=o=>{const s=["85c9d12d5d691d168ba5cb6ecaa749eb","583e63953a6ed6bf304e68120db4c512","93d1fdef41f93d2211deed6d22780c48","7e2ced6843b376a14f69a9f5885d3d2d","44964a97c8c44e4d04efdf3cba594467","57f1b8146ef867f14189f3f4bb1adc1c"],t=s[u.default.randInt(0,s.length-1)];return[o?"https://t{0-7}.tianditu.gov.cn/DataServer?T=img_w&X={x}&Y={y}&L={z}&tk="+t:"https://t{0-7}.tianditu.gov.cn/DataServer?T=vec_w&X={x}&Y={y}&L={z}&tk="+t,"https://t{0-7}.tianditu.gov.cn/DataServer?T=cva_w&X={x}&Y={y}&L={z}&tk="+t]},Me=o=>o?["https://webst0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=6&x={x}&y={y}&z={z}","https://webst0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}"]:["https://webrd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}"],Be=(o,s)=>{let t=s.webMapTiles;if(t||(s.baseMapType=="WGS84"?t=Ee():s.baseMapType=="GCJ02"&&(t=Me())),!!t)for(let e=0;e<t.length;e++){const r=`${s.baseMapType}_base_webmap_source_${e}`;o.addRasterSource(r,{type:"raster",tiles:ue(t[e],o)});const i=`${s.baseMapType}_base_webmap_layer_${e}`;o.addRasterLayer(i,r,{})}},Ar={"FullscreenControl.Enter":"\u8FDB\u5165\u5168\u5C4F","FullscreenControl.Exit":"\u9000\u51FA\u5168\u5C4F","NavigationControl.ZoomIn":"\u653E\u5927","NavigationControl.ZoomOut":"\u7F29\u5C0F","NavigationControl.ResetBearing":"\u65B9\u4F4D\u89D2\u590D\u4F4D","ScaleControl.Meters":"","ScaleControl.Kilometers":"K"};var Oe=(o=>(o.None="none",o.Direct="direct",o.Auto="auto",o.Param="param",o))(Oe||{});const te=async(o,s,t,e)=>{if(Array.isArray(t)){for await(let r of t)if(!r.layer){r.style||(r.style={backcolor:e!=null?e:0});let i=await o.createStyle(r.style,r.mapid,r.version);r.layer=i.stylename}}else if(!t.layer){t.style||(t.style={backcolor:e!=null?e:0});let r=await o.createStyle(t.style,t.mapid,t.version);t.layer=r.stylename}return t},Re=async(o,s,t,e)=>{let r;const i=async a=>{var c,h,f,g,d;if(!a.mapid)return;let n=await o.metadata(a.mapid,a.version),l=u.default.GeoBounds.fromString(n.bounds);if(s=="auto")if(R(t)){let m=a.fourParameterX!==void 0?[(c=a.fourParameterX)!=null?c:0,(h=a.fourParameterY)!=null?h:0,(f=a.fourParameterScale)!=null?f:1,(g=a.fourParameterRotate)!=null?g:0].join(","):void 0,y=l.toPointArray(),A=new u.default.GeoBounds;for await(let L of y){let D=await ze(o,u.default.geoPoint(L),(d=a.crs)!=null?d:"",m,t=="WGS84");A.update([u.default.geoPoint(D)])}return A}else return;else if(s=="param"){if(R(a.baseMapType))return;let m=l.toPointArray(),y;for(let A of m)if(a.coordinates){let L=Ue(u.default.geoPoint(A),a.coordinates,a.isSetRotateZero,R(t));y||(y=new u.default.GeoBounds),y.update([u.default.geoPoint(L)])}return y}return l};if(Array.isArray(e))for await(let a of e){let n=await i(a);if(!n)return;r||(r=new u.default.GeoBounds),r.updateByBounds(n)}else{let a=await i(e);if(!a)return;r||(r=new u.default.GeoBounds),r.updateByBounds(a)}return r},Ve=(o,s,t)=>{const e=r=>{var i,a,n,l,c,h;if(o=="param"){if(!r.coordinates||r.coordinates.length<=1)return;if(R(s.baseMapType)){let f=r.coordinates.map(m=>u.default.geoPoint(u.default.Projection.lngLat2Mercator([m.x1,m.y1]))),g=r.coordinates.map(m=>u.default.geoPoint([m.x2,m.y2])),d=u.default.coordTransfromGetFourParamter(f,g,(i=r.isSetRotateZero)!=null?i:!1,!0);return[d.dx,d.dy,d.scale,d.rotate]}else{let f=r.coordinates.map(m=>u.default.geoPoint([m.x1,m.y1])),g=r.coordinates.map(m=>u.default.geoPoint([m.x2,m.y2])),d=u.default.coordTransfromGetFourParamter(f,g,(a=r.isSetRotateZero)!=null?a:!1,!0);return[d.dx,d.dy,d.scale,d.rotate]}}else return r.fourParameterX!==void 0?[(n=r.fourParameterX)!=null?n:0,(l=r.fourParameterY)!=null?l:0,(c=r.fourParameterScale)!=null?c:1,(h=r.fourParameterRotate)!=null?h:0]:void 0};if(Array.isArray(t)){if(t.length==1)return{mapid:t[0].mapid,version:t[0].version,layers:t[0].layer,crs:t[0].crs,fourParameter:e(t[0])};{let r=[],i=[],a=[],n=[],l=[];for(let c=0;c<t.length;c++)r.push(t[c].mapid),i.push(t[c].version),a.push(t[c].layer),n.push(t[c].crs),l.push(e(t[c]));return{mapid:r,version:i,layers:a,crs:n,fourParameter:l}}}else return{mapid:t.mapid,version:t.version,layers:t.layer,crs:t.crs,fourParameter:e(t)}},je=async(o,s,t,e,r)=>(await te(o,s,e),o.wmsTileUrl({...Ve(s,t,e),mapbounds:t.mapbounds,...r})),Ne=async(o,s,t,e,r)=>{await te(o,s,e);const i=u.default.cloneDeep(Ve(s,t,e));if(i.fourParameter)if(Array.isArray(i.mapid))for(let a=0;a<i.fourParameter.length;a++)typeof i.fourParameter[a][0]=="number"&&(i.fourParameter[a][0]=-i.fourParameter[a][0]),typeof i.fourParameter[a][1]=="number"&&(i.fourParameter[a][1]=-i.fourParameter[a][1]),i.fourParameter[a][0]=i.fourParameter[a][0]||0,i.fourParameter[a][1]=i.fourParameter[a][1]||0,i.fourParameter[a][2]=i.fourParameter[a][2]||1,i.fourParameter[a][3]=i.fourParameter[a][3]||0;else typeof i.fourParameter[0]=="number"&&(i.fourParameter[0]=-i.fourParameter[0]),typeof i.fourParameter[1]=="number"&&(i.fourParameter[1]=-i.fourParameter[1]),i.fourParameter[0]=i.fourParameter[0]||0,i.fourParameter[1]=i.fourParameter[1]||0,i.fourParameter[2]=i.fourParameter[2]||1,i.fourParameter[3]=i.fourParameter[3]||0;return o.wmsTileUrl({...i,srs:"EPSG:3857",webMapType:t.baseMapType,...r})},He=async(o,s,t,e)=>{var a,n,l,c,h,f;let r;if(Array.isArray(t)?r=t.find(g=>R(g.baseMapType)):r=t,!r)return;const i=((a=r.webMapTiles)==null?void 0:a.map(g=>ke(g)))||[];return o.webMapUrl({tileCrs:r.baseMapType=="GCJ02"?"gcj02":"wgs84",tileUrl:(n=i==null?void 0:i.map(g=>g.tileUrl))!=null?n:"",tileSize:256,tileRetina:1,tileMaxZoom:18,tileShards:i.length>=0?i[0].tileShards:"",tileToken:"",tileFlipY:!1,mapbounds:s.mapbounds,srs:r.crs,fourParameterBefore:r.fourParameterX!==void 0?[(l=r.fourParameterX)!=null?l:0,(c=r.fourParameterY)!=null?c:0,(h=r.fourParameterScale)!=null?h:1,(f=r.fourParameterRotate)!=null?f:0].join(","):void 0})},Ge=async(o,s,t,e,r)=>{await te(o,s,e);let i;return R(t.baseMapType)||(i=t.mapbounds,i&&(i=i.replace("[",""),i=i.replace("]",""))),o.wmsTileUrl({...Ve(s,t,e),mapbounds:i,...r})},We=async(o,s,t,e)=>{let r;if(t=="direct"?r=await je(o,t,s,e.maps,e.layerProps):t=="auto"?R(s.baseMapType)?r=await Ne(o,t,s,e.maps,e.layerProps):r=await He(o,s,e.maps,e.layerProps):t=="param"&&(r=await Ge(o,t,s,e.maps,e.layerProps)),!!r)return[r]},ze=async(o,s,t,e,r)=>{if(e){let n=e.split(",");s=u.default.coordTransfromByFourParamter(s,{dx:+n[0],dy:+n[1],scale:+n[2],rotate:+n[3]})}let a=(await o.cmdTransform(t,"EPSG:4326",s))[0];return r===!1&&(a=u.default.transform.convert(a,u.default.transform.CRSTypes.EPSG4326,u.default.transform.CRSTypes.AMap)),a},it=async(o,s,t,e,r)=>{r===!1&&(s=u.default.transform.convert(s,u.default.transform.CRSTypes.AMap,u.default.transform.CRSTypes.EPSG4326));let a=(await o.cmdTransform("EPSG:4326",t,u.default.geoPoint(s)))[0];if(e){let n=e.split(",");a=u.default.coordTransfromByFourParamter(u.default.geoPoint(a),{dx:+n[0],dy:+n[1],scale:+n[2],rotate:+n[3]})}return u.default.geoPoint(a).toArray()},Ue=(o,s,t,e)=>{let r;e?r=s.map(l=>u.default.geoPoint(u.default.Projection.lngLat2Mercator([l.x1,l.y1]))):r=s.map(l=>u.default.geoPoint([l.x1,l.y1]));let i=s.map(l=>u.default.geoPoint([l.x2,l.y2]));if(r.length==0||i.length==0)return u.default.geoPoint(o);let a=u.default.coordTransfromGetFourParamter(i,r,t!=null?t:!1,!0),n=u.default.coordTransfromByFourParamter(o,a);return e&&(n=u.default.geoPoint(u.default.Projection.mercator2LngLat(n))),n},ot=(o,s,t,e)=>{let r;e?r=s.map(n=>u.default.geoPoint(u.default.Projection.lngLat2Mercator([n.x1,n.y1]))):r=s.map(n=>u.default.geoPoint([n.x1,n.y1]));let i=s.map(n=>u.default.geoPoint([n.x2,n.y2]));if(r.length==0||i.length==0)return u.default.geoPoint(o);let a=u.default.coordTransfromGetFourParamter(r,i,t!=null?t:!1,!0);return e&&(o=u.default.geoPoint(u.default.Projection.lngLat2Mercator(o))),u.default.coordTransfromByFourParamter(o,a)},he=()=>{let o;const s=l=>{o=l};document.addEventListener("keydown",s);const t=l=>{o=void 0};return document.addEventListener("keyup",t),{removeEventListener:()=>{document.removeEventListener("keydown",s),document.removeEventListener("keyup",t)},isAltKey:()=>o==null?void 0:o.altKey,isCtrlKey:()=>o==null?void 0:o.ctrlKey,isShiftKey:()=>o==null?void 0:o.shiftKey,curKey:()=>o}};class at{constructor(s){b(this,"config");b(this,"svc");b(this,"map");b(this,"sources");b(this,"layers");b(this,"controls");b(this,"layersInst");b(this,"projectKey");b(this,"containerId");b(this,"timeMgr");b(this,"isEditorMode");b(this,"isDisableRunProgram");b(this,"context");b(this,"programCleaner");b(this,"oldCacheImages");b(this,"keyEvent");this.config=s||{},this.sources=[],this.layers=[],this.layersInst={},this.timeMgr={},this.config.mapSources=[],this.config.mapLayers=[]}mount(s,t){var a,n,l,c,h,f,g;if(this.svc)return;if(this.keyEvent||(this.keyEvent=he()),this.containerId=s,(a=this.config)!=null&&a.backgroundColor){const d=document.getElementById(s);d&&(d.style.backgroundColor=(n=this.config)==null?void 0:n.backgroundColor)}this.svc=new u.default.Service((c=(l=this.config.serviceUrl)!=null?l:t==null?void 0:t.serviceUrl)!=null?c:"",(f=(h=this.config.serviceToken)!=null?h:t==null?void 0:t.serviceToken)!=null?f:""),this.config.workspace&&this.svc.switchWorkspace(this.config.workspace),this.config.accessKey&&this.config.accessKey.split(";").map(d=>this.svc.addAccessKey(d));const e=(g=this.config.mapInitBounds)!=null?g:"[-10000,-10000,10000,10000]",r=u.default.GeoBounds.fromString(e),i=new u.default.GeoProjection(r);this.map=new u.default.Map({container:s,style:{version:this.svc.styleVersion(),glyphs:this.svc.glyphsUrl(),sources:{},layers:[]},center:i.toLngLat(r.center()),zoom:2,renderWorldCopies:!1,preserveDrawingBuffer:this.isEditorMode?!0:void 0,doubleClickZoom:!1,locale:Ar,...this.config.mapOptions}),this.map.attach(this.svc,i)}attachMap(s){this.map=s,this.svc=this.map.getService(),this.keyEvent||(this.keyEvent=he())}isWebBaseMap(s){var e;let t=(e=s!=null?s:this.config)!=null?e:{};return!(t.baseMapType==""||t.baseMapType=="CAD"||t.baseMapType===void 0)}async setConfig(s,t){var n,l,c,h,f,g,d,m,y,A,L,D,C,v;if(s||(s=u.default.cloneDeep(this.config)),!this.map)return;if(await this.map.onLoad(),this.clearData(),s&&(this.config=s),(n=this.config)!=null&&n.backgroundColor){const w=this.map.getContainer();w&&(w.style.backgroundColor=(l=this.config)==null?void 0:l.backgroundColor)}const e=[...(c=s==null?void 0:s.mapSources)!=null?c:[]],r=[...(h=s==null?void 0:s.mapLayers)!=null?h:[]];if(this.svc=new u.default.Service((d=(g=this.config.serviceUrl)!=null?g:(f=this.svc)==null?void 0:f.serverUrl)!=null?d:"",(A=(y=this.config.serviceToken)!=null?y:(m=this.svc)==null?void 0:m.accessToken)!=null?A:""),this.isWebBaseMap()){let w=new u.default.LnglatProjection;this.map.attach(this.svc,w),Be(this.map,this.config)}else{if(!((L=this.config.mapOpenOptions)!=null&&L.mapid)&&this.config.mapInitBounds){const w=this.config.mapInitBounds,S=u.default.GeoBounds.fromString(w),k=new u.default.GeoProjection(S);this.map.setMapProjection(k)}this.map.attach(this.svc,this.map.getMapProjection())}if(this.config.workspace&&this.svc.switchWorkspace(this.config.workspace),this.config.accessKey&&this.config.accessKey.split(";").map(w=>this.svc.addAccessKey(w)),!this.isWebBaseMap()&&(this.config.mapOpenOptions=this.config.mapOpenOptions||{},(D=this.config.mapOpenOptions)!=null&&D.style||(this.config.mapOpenOptions.style=u.default.openMapDarkStyle()),(C=this.config.mapOpenOptions)!=null&&C.mapid)){const w=await this.switchMap(this.config.mapOpenOptions);if(w!=null&&w.error)return{error:w.error}}t||this.setMapOptions((v=this.config.mapOptions)!=null?v:{}),await this.map.onLoad(!0),await this.addMapImages();let i=[],a=[];e.filter(w=>!(w.tag=="change"&&w.change&&w.change.reqType=="SOURCE")).forEach(w=>i.push(this.addSource(w,!0))),await Promise.all(i),e.filter(w=>w.tag=="change"&&w.change&&w.change.reqType=="SOURCE").forEach(w=>a.push(this.addSource(w,!0))),await Promise.all(a);for(let w of r)await this.addLayer(w,!0);this.addControls(),await this.execProgram()}async setMapOpenOptions(s){this.config.mapOpenOptions={...this.config.mapOpenOptions,...s},await this.setConfig()}setMapOptions(s){this.config.mapOptions={...this.config.mapOptions,...s},this.map&&(s.center?this.map.setCenter(s.center):this.isWebBaseMap()&&this.map.setCenter([116.3912,39.9073]),s.zoom!==void 0?this.map.setZoom(s.zoom):this.isWebBaseMap()&&this.map.setZoom(8),s.bearing!==void 0&&this.map.setBearing(s.bearing),s.pitch!==void 0&&this.map.setPitch(s.pitch),s.dragRotate===!1&&this.map.dragRotate.isEnabled()?(this.map.dragRotate.disable(),this.map.touchZoomRotate.disableRotation(),this.map.getCanvasContainer().oncontextmenu=t=>{t.preventDefault()}):s.dragRotate&&!this.map.dragRotate.isEnabled()&&(this.map.dragRotate.enable(),this.map.touchZoomRotate.enableRotation(),this.map.getCanvasContainer().oncontextmenu=()=>{}),s.pitchWithRotate===!1?this.map.setMaxPitch(0):this.map.setMaxPitch(85))}async addMapImages(){try{if(!this.config.mapImages)return;this.oldCacheImages=this.oldCacheImages||{};let s=[...this.config.mapImages];s=s.filter(e=>e.key&&e.value),s=s.filter(e=>{const r=e.value+"_"+e.options;return this.oldCacheImages[e.key]!=r});for(let e of s)this.map.hasImage(e.key)&&this.map.removeImage(e.key);let t=[];for(let e of s){let r;if(this.oldCacheImages[e.key]=e.value+"_"+e.options,typeof e.options=="string")try{r=JSON.parse(e.options)}catch(a){console.error(a)}let i=rt[e.value];i?t.push(this.map.addImage(e.key,i(this.map,r),r)):t.push(this.map.loadImageEx(e.key,e.value,r))}await Promise.all(t)}catch(s){console.error(s)}}async clearData(){if(!this.map)return;const{sources:s}=this.map.getStyle();this.removePrograms();for(const t in this.layersInst){const e=this.layersInst[t];e&&e.removeLayer(this.map,t)}for(const t in s)this.map.removeSourceEx(t);this.map.removeMarkers(),this.map.removePopups(),this.removeControls(),this.sources=[],this.layers=[],this.layersInst=[],this.config.mapSources=[],this.config.mapLayers=[],this.oldCacheImages={};for(let t in this.timeMgr)clearInterval(this.timeMgr[t]);this.timeMgr={}}removePrograms(){if(this.programCleaner){for(let s of this.programCleaner)s&&s();this.programCleaner=[]}}async execProgram(){if(!this.isDisableRunProgram&&(this.removePrograms(),this.config.program&&this.config.program.onMapLoaded)){let s=await Se(this.config.program.onMapLoaded,this.map,this,this.context);typeof s=="function"&&(this.programCleaner=this.programCleaner||[],this.programCleaner.push(s))}}async destory(){this.clearData(),this.map&&(this.map.remove(),this.map=null),this.keyEvent&&this.keyEvent.removeEventListener()}async switchMap(s){this.config.mapOpenOptions=s;const t=await this.map.switchMap(s,s.isKeepOldLayers,s.isVectorStyle,s.isSetCenter,s.isFitBounds);return t!=null&&t.error?{error:t.error}:t}async addSource(s,t){var i,a;const e=u.default.cloneDeep(s);if(this.sources.findIndex(n=>n.id===e.id)>=0)return!1;if(this.sources.push(u.default.cloneDeep(e)),t&&((i=this.config.mapSources)==null?void 0:i.findIndex(l=>l.id===e.id))==-1&&((a=this.config.mapSources)==null||a.push(u.default.cloneDeep(e))),e.tag==="query"){let n=await ee(this.map,e.query);e.source.data=n}else if(e.tag==="change"){let n=await Z(this.map,e.change,this);e.source.data=n,this.addTimer(e)}if(e.source.type==="geojson"){const n=u.default.cloneDeep(e.source);n.data=this.map.toLngLat(n.data);for(let l in e.props)n[l]=e.props[l];this.map.addSourceEx(e.id,n)}else await this.updateSource(e);return!0}async getSourceData(s){const t=this.sources.findIndex(r=>r.id===s);if(t<0)return;const e=this.sources[t];if(e.tag==="query")return await ee(this.map,e.query);if(e.tag==="change")return await Z(this.map,e.change,this);if(e.source.type==="geojson")return u.default.cloneDeep(e.source).data}async setSourceData(s,t,e){var n,l;const r=this.sources.findIndex(c=>c.id===s);if(r<0)return;let i=-1;e&&(i=(l=(n=this.config.mapSources)==null?void 0:n.findIndex(c=>c.id===s))!=null?l:-1);let a=!0;if(this.sources[r].tag==="query")this.sources[r].query=t,i>=0&&this.config.mapSources&&(this.config.mapSources[i].query=u.default.cloneDeep(t)),t=await ee(this.map,this.sources[r].query);else if(this.sources[r].tag==="change")this.sources[r].change=t,i>=0&&this.config.mapSources&&(this.config.mapSources[i].change=u.default.cloneDeep(t)),t=await Z(this.map,this.sources[r].change,this),this.addTimer(this.sources[r]);else if(this.sources[r].source.type==="geojson")this.sources[r].source.data=t,i>=0&&this.config.mapSources&&(this.config.mapSources[i].source.data=u.default.cloneDeep(t));else{if(this.sources[r].tag==="wms"){const c=this.sources[r].source.type;this.sources[r].wms=t.wms,this.sources[r].source={...t.source},c&&(this.sources[r].source.type=c),i>=0&&this.config.mapSources&&(this.config.mapSources[i].wms=u.default.cloneDeep(t.wms),this.config.mapSources[i].source={type:this.sources[i].source.type,...t.source},c&&(this.config.mapSources[i].source.type=c))}else{const c=this.sources[r].source.type;this.sources[r].source=u.default.cloneDeep(t),c&&(this.sources[r].source.type=c),i>=0&&this.config.mapSources&&(this.config.mapSources[i].source=u.default.cloneDeep(t),c&&(this.config.mapSources[i].source.type=c))}await this.updateSource(this.sources[r],!0),a=!1}a&&this.map.setData(s,this.map.toLngLat(t)),await this.notifySourceDataChange(s,!a)}async updateSource(s,t){var r,i,a,n,l,c,h,f;let e=u.default.cloneDeep(s);if(t&&this.map.removeSourceEx(e.id),e.source.type==="raster"||e.source.type==="vector"){if(e.source.bounds){const g=this.map.toLngLat([e.source.bounds[0],e.source.bounds[1]]),d=this.map.toLngLat([e.source.bounds[2],e.source.bounds[3]]);e.source.bounds=[g[0],g[1],d[0],d[1]]}if(e.tag=="wms"&&(e.source.tiles=await We(this.svc,{baseMapType:this.config.baseMapType,mapid:(r=this.config.mapOpenOptions)==null?void 0:r.mapid,version:(i=this.config.mapOpenOptions)==null?void 0:i.version,mapbounds:this.map.getGeoBounds(1).toString()},(a=e.wms)==null?void 0:a.overlayType,(n=e.wms)==null?void 0:n.param),!e.source.bounds)){let g=await Re(this.svc,(l=e.wms)==null?void 0:l.overlayType,(c=this.config.baseMapType)!=null?c:"",(f=(h=e.wms)==null?void 0:h.param)==null?void 0:f.maps);if(g){let d=this.map.toLngLat(g).toArray();e.source.bounds=[d[0][0],d[0][1],d[1][0],d[1][1]]}}e.source.tiles||(e.source.tiles=ue(e.source.tiles,this.map)),e.source.type==="raster"?this.map.addRasterSource(e.id,e.source):this.map.addVectorSource(e.id,e.source,{})}else e.source.type==="image"||e.source.type==="video"?(e.source.coordinates&&(e.source.coordinates=this.map.toLngLat(e.source.coordinates)),e.source.type==="image"?this.map.addImageSource(e.id,e.source):this.map.addVideoSource(e.id,e.source)):this.map.addSourceEx(e.id,e.source)}removeSource(s,t){var r,i;for(let a=this.layers.length-1;a>=0;a--)this.layers[a].sourceId==s&&this.removeLayer(this.layers[a].layerId,!0);this.map.removeSourceEx(s);const e=this.sources.findIndex(a=>a.id===s);if(e>=0&&this.sources.splice(e,1),t){const a=(r=this.config.mapSources)==null?void 0:r.findIndex(n=>n.id===s);a!==void 0&&a>=0&&((i=this.config.mapSources)==null||i.splice(a,1))}this.clearTimer(s)}async addLayer(s,t){var n,l,c;const e=u.default.cloneDeep(s);if(this.layers.findIndex(h=>h.layerId===e.layerId)<0&&this.layers.push(u.default.cloneDeep(e)),t&&((n=this.config.mapLayers)==null?void 0:n.findIndex(f=>f.layerId===e.layerId))==-1&&((l=this.config.mapLayers)==null||l.push(u.default.cloneDeep(e))),e.visibleOff||this.layersInst[e.layerId])return;let i=xe[e.type];i||console.error(`\u56FE\u5C42\u7C7B\u578B ${e.type} \u672A\u6CE8\u518C`);let a=new i;if(await a.addLayer(this.map,e),this.layersInst[e.layerId]=a,s.isLowest&&a.getLayerId()){let h=this.map.getStyle().layers,f=(c=a.getLayerId())!=null?c:[];Array.isArray(f)||(f=[f]);for(let g=0;g<h.length-1;g++)h.findIndex(d=>d.id==f[g])>=0&&this.map.moveLayer(f[g],h[0].id)}}async setLayerStyle(s,t,e){var i;const r=this.layers.findIndex(a=>a.layerId===s);if(!(r<0)&&(this.layersInst[s]?(this.layersInst[s].setLayerStyle(this.map,s,t,this.layers[r]),this.layers[r]=P(this.layers[r],t)):(this.layers[r]=P(this.layers[r],t),await this.addLayer(this.layers[r],e)),e)){const a=(i=this.config.mapLayers)==null?void 0:i.findIndex(n=>n.layerId===s);a!==void 0&&a>=0&&this.config.mapLayers&&(this.config.mapLayers[a]=u.default.cloneDeep(this.layers[r]))}}async setLayerVisible(s,t,e){var i;const r=this.layers.findIndex(a=>a.layerId===s);if(!(r<0)&&(this.layers[r].visibleOff=t,this.layersInst[s]||await this.addLayer(this.layers[r],e),this.layersInst[s].setVisible(this.map,s,t),e)){const a=(i=this.config.mapLayers)==null?void 0:i.findIndex(n=>n.layerId===s);a!==void 0&&a>=0&&this.config.mapLayers&&(this.config.mapLayers[a].visibleOff=t)}}async setSourceVisible(s,t,e){for(let r of this.layers)r.sourceId==s&&await this.setLayerVisible(r.layerId,t)}removeLayer(s,t){var r,i;if(!this.layersInst[s])return;this.layersInst[s].removeLayer(this.map,s),delete this.layersInst[s];const e=this.layers.findIndex(a=>a.layerId===s);if(e>=0&&this.layers.splice(e,1),t){const a=(r=this.config.mapLayers)==null?void 0:r.findIndex(n=>n.layerId===s);a!==void 0&&a>=0&&((i=this.config.mapLayers)==null||i.splice(a,1))}}addTimer(s){this.clearTimer(s.id),s.change.interval>0&&(this.timeMgr[s.id]=setInterval(async()=>{if(!this.map)return;let t=await Z(this.map,s.change,this);this.map.getSource(s.id)!==void 0&&(this.map.setData(s.id,this.map.toLngLat(t)),await this.notifySourceDataChange(s.id,!1,!0))},s.change.interval*1e3))}clearTimer(s){this.timeMgr[s]&&(clearInterval(this.timeMgr[s]),delete this.timeMgr[s])}removeControls(){if(this.controls){for(let s of this.controls)s&&this.map.removeControl(s);this.controls=[]}}addControls(){if(this.removeControls(),!!this.config.controls){this.controls=this.controls||[];for(let s of this.config.controls){let t,e=s.name,r=s.options?JSON.parse(s.options):{};if(e=="DrawTool")t=new u.default.Draw.Tool(r);else{if(e=="Custom"){if(e=r.controlName,!e){console.warn("custom control options need include controlName field "),this.controls.push(null);continue}}else e=="MiniMapControl"&&(r.containerStyle||(r.containerStyle={background:this.config.backgroundColor,transform:"scale(0.6)",transformOrigin:`${s.position.indexOf("left")>=0?"0%":"100%"} ${s.position.indexOf("top")>=0?"0%":"100%"}`}));if(!e)continue;if(!u.default[e]){console.warn(`${e} is not vjmap class`),this.controls.push(null);continue}t=new u.default[e](r)}r!=null&&r.locale&&(this.map._locale={...this.map._locale,...r==null?void 0:r.locale}),this.map.addControl(t,s.position),this.controls.push(t)}}}getConfig(){return this.config}findDepsSourceId(s,t){var e;if(!!s){for(let r=0;r<this.sources.length;r++)if(this.sources[r].tag==="change"&&((e=this.sources[r].change)==null?void 0:e.fromSourceId)==s){let i=this.sources[r].id;i&&!t.has(i)&&(t.add(i),this.findDepsSourceId(i,t))}}}async notifySourceDataChange(s,t,e){var i,a;if(!s)return;let r=new Set;r.add(s),this.findDepsSourceId(s,r);for(let n of r){const l=this.sources.findIndex(c=>c.id===n);if(l>=0&&this.sources[l].tag==="change"&&((i=this.sources[l].change)==null?void 0:i.fromSourceId)){const c=await Z(this.map,this.sources[l].change,this);this.map.setData(n,this.map.toLngLat(c))}}for(let n in this.layersInst)for(let l of r)(a=this.layersInst[n])==null||a.onSourceDataChange(this.map,l,t,e)}getSysImages(){return Object.keys(rt)}static guid(s=8){return"x".repeat(s).replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}}const ge=(o,s,t,e,r)=>{var a;if(s.symbol&&s.text&&r)return wr(o,s,r);const i=new u.default.DbLine({color:s.color?parseInt(s.color.substring(1),16):0,start:o,end:o,alpha:((a=s.opacity)!=null?a:1)*255});return K(i),[i]},ye=(o,s,t)=>{const e=[0,5,9,13,15,18,20,25,30,35,40,50,53,60,70,80,90,100,106,120,140,158,200,211];let r=s.line_width?s.line_width*10:void 0;if(r){for(let n=1;n<e.length;n++)if(r<e[n]){r=e[n-1];break}}let i=t?s.line_opacity:s.opacity;if(s.center&&s.pointInCircle)return br(o,s,r,i);const a=new u.default.Db2dPolyline({color:s.color?parseInt(s.color.substring(1),16):0,points:o,lineWidth:r,alpha:(i!=null?i:1)*255,elevation:s.elevation});return K(a),[a]},me=(o,s,t)=>{var a,n;let e=[],r=t?s.fillColor:s.color,i=new u.default.DbHatch({color:r?parseInt(r.substring(1),16):0,points:o.length==1?o[0]:o,pattern:"SOLID",alpha:((a=s.opacity)!=null?a:1)*255});if(K(i),e.push(i),!t&&!s.noneOutline&&s.color!=s.outlineColor){let l=new u.default.Db2dPolyline({color:s.outlineColor?parseInt(s.outlineColor.substring(1),16):0,points:o,alpha:((n=s.opacity)!=null?n:1)*255});K(l),e.push(l)}return e},wr=(o,s,t)=>{const e=s.text_size_zoom1?t.pixelToGeoLength(s.text_size_zoom1,1):t.getGeoBounds().height()/80;o[1]-=e/2;const r=new u.default.DbMText({color:s.color?parseInt(s.color.substring(1),16):0,location:[o[0],o[1]],attachment:2,contents:s.text,rotation:u.default.degreesToRadians(-parseFloat(s.text_rotate)),textHeight:e});return K(r),[r]},pe=(o,s,t)=>{var d,m;let e=s.export||{};if(!e.refCo1||!e.refCo2||!e.height||!e.position)return;let r,i,a,n,l;if(o.geometry.type=="Polygon")n=o.geometry.coordinates[0][0],l=o.geometry.coordinates[o.geometry.coordinates.length-1][1];else if(o.geometry.type=="MultiPolygon"){n=o.geometry.coordinates[0][0][0];let y=o.geometry.coordinates[o.geometry.coordinates.length-1];l=y[y.length-1][1]}else if(o.geometry.type=="MultiLineString")n=o.geometry.coordinates[0][0],l=o.geometry.coordinates[o.geometry.coordinates.length-1][1];else if(o.geometry.type=="GeometryCollection"){let y=o.geometry.geometries[0];y.type=="LineString"?n=y.coordinates[0]:y.type=="Polygon"&&(n=y.coordinates[0][0]);let A=o.geometry.geometries[o.geometry.geometries.length-1];A.type=="LineString"?l=A.coordinates[1]:A.type=="Polygon"&&(l=A.coordinates[A.coordinates.length-1][1])}if(!n||!l)return;let c=u.default.coordTransfromGetFourParamter([u.default.geoPoint(e.refCo1),u.default.geoPoint(e.refCo2)],[u.default.geoPoint(n),u.default.geoPoint(l)],!1,!0),h=u.default.coordTransfromByFourParamter(u.default.geoPoint(e.position),c);r=h.x,i=h.y,a=e.height*c.scale;let f,g={...e,rotation:((d=c.rotate)!=null?d:0)+((m=e.textRotate)!=null?m:0),color:s.color?parseInt(s.color.substring(1),16):0};return e.isMText?f=new u.default.DbMText({...g,location:[r,i],textHeight:a}):f=new u.default.DbText({...g,position:[r,i],height:a}),K(f),[f]},br=(o,s,t,e)=>{const r=o[0],i=o[o.length/2],a=new u.default.DbCircle({color:s.color?parseInt(s.color.substring(1),16):0,center:[(r[0]+i[0])/2,(r[1]+i[1])/2],radius:u.default.geoPoint(r).distanceTo(u.default.geoPoint(i))/2,lineWidth:t,alpha:(e!=null?e:1)*255});return K(a),[a]},K=o=>((o.color==0||o.color==16777215)&&(o.colorIndex=7,delete o.color),o),nt=async(o,s,t)=>{let e=s.getAll();e=o.fromLngLat(e);const i=o.getGeoBounds().width()/200;let a=[];for(let g=0;g<e.features.length;g++){let d=e.features[g];if(re(d)){const m=V(s,"deleteEntitys");m&&Array.from(new Set(m)).forEach(y=>{a.push({objectid:y,delete:!0})});continue}if(d.geometry.type=="Point")a.push(...ge(d.geometry.coordinates,d.properties,i,!1,o));else if(d.geometry.type=="LineString")a.push(...ye(d.geometry.coordinates,d.properties));else if(d.geometry.type=="Polygon"){if(d.properties.export){const m=pe(d,d.properties);if(m&&m.length>0){a.push(...m);continue}}a.push(...me(d.geometry.coordinates,d.properties))}else if(d.geometry.type=="MultiPoint")for(let m of d.geometry.coordinates)a.push(...ge(m,d.properties,i,!1,o));else if(d.geometry.type=="MultiLineString"){if(d.properties.export){const m=pe(d,d.properties);if(m&&m.length>0){a.push(...m);continue}}for(let m of d.geometry.coordinates)a.push(...ye(m,d.properties))}else if(d.geometry.type=="MultiPolygon"){if(d.properties.export){const m=pe(d,d.properties);if(m&&m.length>0){a.push(...m);continue}}for(let m of d.geometry.coordinates)a.push(...me(m,d.properties))}else if(d.geometry.type=="GeometryCollection"){if(d.properties.export){const m=pe(d,d.properties);if(m&&m.length>0){a.push(...m);continue}}for(let m=0;m<d.geometry.geometries.length;m++){let y=d.geometry.geometries[m];if(y.type=="Polygon")a.push(...me(y.coordinates,d.properties,!0));else if(y.type=="MultiPolygon")for(let A of y.coordinates)a.push(...me(A,d.properties,!0))}for(let m=0;m<d.geometry.geometries.length;m++){let y=d.geometry.geometries[m];if(y.type=="Point")a.push(...ge(y.coordinates,d.properties,i,!0,o));else if(y.type=="LineString")a.push(...ye(y.coordinates,d.properties,!0));else if(y.type=="MultiPoint")for(let A of y.coordinates)a.push(...ge(A,d.properties,i,!0,o));else if(y.type=="MultiLineString")for(let A of y.coordinates)a.push(...ye(A,d.properties,!0))}}else console.warn("unknow FeatureCollection type:"+d.geometry.type)}let n=new u.default.DbDocument,l=o.getService(),c=l.currentMapParam();c!=null&&c.mapid&&(c.maptype||(n.from=`${c==null?void 0:c.mapid}/${c==null?void 0:c.version}`)),n.appendEntity(a);let h=new u.default.Service(l.serverUrl,l.accessToken);return l.getCurWorkspaceName()&&h.switchWorkspace(l.getCurWorkspaceName()),await h.updateMap({mapid:t||"draw"+(c==null?void 0:c.mapid),filedoc:n.toDoc(),mapopenway:u.default.MapOpenWay.Memory,style:{backcolor:0}})},re=o=>o?o.id=="__data_track__":!1,_e=(o,s)=>{let e=o.getAll().features.find(r=>re(r));if(!e)o.add({id:"__data_track__",type:"Feature",properties:{...s,radius_inactive:1,radius_static:1,opacity:0,_hover_opacity:0,isOff:!0,isLocked:!0},geometry:{coordinates:[0,0],type:"Point"}});else if(e!=null&&e.id)for(let r in s)o.setFeatureProperty(e==null?void 0:e.id,r,s[r])},V=(o,s)=>{let e=o.getAll().features.find(r=>re(r));if(e&&e.properties)return s?e.properties[s]:e.properties},Ae=(o,s)=>{let t={};if(s.features.length>0){let e=s.features[0];e.geometry.type=="Polygon"?t.refCo1=o.fromLngLat(e.geometry.coordinates[0][0]):e.geometry.type=="LineString"&&(t.refCo1=o.fromLngLat(e.geometry.coordinates[0])),e=s.features[s.features.length-1],e.geometry.type=="Polygon"?t.refCo2=o.fromLngLat(e.geometry.coordinates[e.geometry.coordinates.length-1][1]):e.geometry.type=="LineString"&&(t.refCo2=o.fromLngLat(e.geometry.coordinates[1]))}return t},Ze=(o,s,t)=>{const e=s!=null?s:"myhighlight";t=t!=null?t:"#FF8957",o.addGeoJSONSource(`${e}-source`,{type:"FeatureCollection",features:[]}),o.addCircleLayer(`${e}-point-layer`,`${e}-source`,{circleColor:t,circleOpacity:.8,circleRadius:5,filter:["==",["geometry-type"],"Point"]}),o.addLineLayer(`${e}-line-layer`,`${e}-source`,{lineJoin:"round",lineCap:"round",lineColor:t,lineWidth:3,lineOpacity:.8,filter:["==",["geometry-type"],"LineString"]}),o.addFillLayer(`${e}-fill-layer`,`${e}-source`,{fillColor:t,fillOpacity:1,filter:["==",["geometry-type"],"Polygon"]})},se=(o,s)=>{const t=s!=null?s:"myhighlight";o.getSource(`${t}-source`)&&o.getSource(`${t}-source`).setData({type:"FeatureCollection",features:[]})},Lr=async(o,s,t,e)=>{const r=o.getService(),i=s&&u.default.geoPoint([s[0],s[1]]).equals(u.default.geoPoint([s[2],s[3]]));let a;if(i)a=await r.pointQueryFeature({zoom:o.getZoom(),x:s[0],y:s[1],limit:100,...t,fields:"objectid"});else{const f=[];let g=0;const d=5e4;for(;;){const m=await r.conditionQueryFeature({condition:"",bounds:s,fields:"objectid",includegeom:!0,realgeom:!0,isContains:s&&s[0]>s[2],beginpos:g,limit:d,...t});if(!m.result||(g+=d,f.push(...m.result||[]),f.length>=m.recordCount))break}a={result:f,recordCount:f.length}}let n=new Set,l=new Set;if(a.result){for(const f of a.result)if(f.objectid){if(e&&e.has(f.objectid)){l.add("1 != 1");continue}let g="",d=0;for(d=0;d<f.objectid.length&&ce(f.objectid[d]);d++)g+=f.objectid[d];if(g)if(g==f.objectid)n.add(g);else{const m=["_"];for(const y of m)l.add(`objectid like '${g}${y}%'`)}}}let c,h;return n.size>0&&(c=` objectid in (${Array.from(n).map(g=>`"${g}"`).join(",")}) `),l.size>0&&(h=Array.from(l).join(" or ")),c&&h?c+" or "+h:c||(h!=null?h:"")},Ke=async(o,s,t,e,r,i,a,n,l)=>{var A,L,D,C;const c=n!=null?n:"myhighlight",h=o.getService(),f=s&&u.default.geoPoint([s[0],s[1]]).equals(u.default.geoPoint([s[2],s[3]]));let g;r&&(g=await Lr(o,s,e,i));let d;if(f&&!g)d=await h.pointQueryFeature({zoom:o.getZoom(),x:s[0],y:s[1],limit:100,...e});else{let v=[],w=0;const S=5e4;for(;;){let k;if(g?k=await h.conditionQueryFeature({condition:g,fields:"",includegeom:!0,realgeom:!0,beginpos:w,limit:S,...e}):k=await h.conditionQueryFeature({condition:"",bounds:s,fields:"",includegeom:!0,realgeom:!0,isContains:s&&s[0]>s[2],beginpos:w,limit:S,...e}),!k.result||(w+=S,v.push(...k.result||[]),v.length>=k.recordCount))break}d={result:v,recordCount:v.length}}i&&d.result&&(d.result=d.result.filter(v=>!i.has(v.objectid)),d.recordCount=d.result.length);const m={features:[],type:"FeatureCollection"},y={features:[],type:"FeatureCollection"};if(d&&d.result&&d.result.length>0){o.getSource(`${c}-source`)||Ze(o,n,l);for(const w of d.result){if(w.geom&&w.geom.geometries)for(const S in w.geom.geometries){const k={type:"Feature",id:w.id+"_"+S,properties:H(w),geometry:w.geom.geometries[S]};m.features.push(k)}if(!t){const S=w.points||w.positon||w.location||w.origin||w.center;if(S){const T=S.split(";").map(I=>o.toLngLat(u.default.GeoPoint.fromString(I)));if(T.length==1){const I={type:"Feature",id:w.id,properties:H(w),geometry:{type:"Point",coordinates:T[0]}};y.features.push(I)}else if(T.length>1){const I={type:"Feature",id:w.id,properties:H(w),geometry:{type:"LineString",coordinates:T}};y.features.push(I)}}}}const v=t?m:y;v.features.length>0?!a&&((L=(A=o.getSource(`${c}-source`))==null?void 0:A._data)==null?void 0:L.features)?o.getSource(`${c}-source`).setData({features:[...(C=(D=o.getSource(`${c}-source`))==null?void 0:D._data)==null?void 0:C.features,...v.features],type:"FeatureCollection"}):o.getSource(`${c}-source`).setData(v):a&&se(o,c)}else a&&se(o,c);return o.triggerRepaint(),t?m:y},we=(o,s)=>{const t=s!=null?s:"myhighlight";se(o,t),o.triggerRepaint()},be={},Le=async(o,s,t)=>{var l,c;if(t===0){s.features=[];return}const e=o.getService(),r=(l=e.currentMapParam())==null?void 0:l.mapid,i=(c=e.currentMapParam())==null?void 0:c.version;if(!r)return;const a=`${r}_${i}${e.getCurWorkspaceName()}`;if(a in be){s.features=[...be[a].features];return}else{const h=localStorage.getItem("snap_"+a);if(h)try{const f=JSON.parse(h);if(Array.isArray(f)){s.features=[...f],be[a]=s;return}}catch{}}let n=await e.conditionQueryFeature({fields:"s3",condition:"s3 != ''",limit:t!=null?t:1e5});if(!!n.result){n=n.result.map(h=>h.s3.split(";")),s.features=[];for(const h of n){const f=[];for(const g of h){const d=g.split(",");d.length>=2&&f.push(o.toLngLat([+d[0],+d[1]]))}f.length==1?s.features.push({type:"Feature",geometry:{type:"Point",coordinates:f[0]}}):f.length>1&&s.features.push({type:"Feature",geometry:{type:"LineString",coordinates:f}})}be[a]=s;try{localStorage.setItem("snap_"+a,JSON.stringify(s.features))}catch{}}},Je=async(o,s,t,e,r,i)=>{var n;if(((n=o.getService().currentMapParam())==null?void 0:n.mapopenway)==u.default.MapOpenWay.Memory){console.error("\u5185\u5B58\u6253\u5F00\u6A21\u5F0F\u4E0D\u652F\u6301\u9009\u62E9\u5B9E\u4F53\uFF0C\u8BF7\u5207\u6362\u81F3\u51E0\u4F55\u6805\u683C\u6216\u51E0\u4F55\u77E2\u91CF\u65B9\u5F0F\u6253\u5F00\u56FE\u5F62");return}const a={};for(r||Le(o,a),o._selectFeatures=[];;){let l;if(e!=null?e:o._isPointSel){const h=await u.default.Draw.actionDrawPoint(o,{api:{getSnapFeatures:a},contextMenu:f=>{o.fire("keyup",{keyCode:13})}});if(h.cancel)break;l=[h.features[0].geometry.coordinates,h.features[0].geometry.coordinates,h.features[0].geometry.coordinates,h.features[0].geometry.coordinates]}else{const h=await u.default.Draw.actionDrawRectangle(o,{api:{getSnapFeatures:a},contextMenu:f=>{o.fire("keyup",{keyCode:13})}});if(h.cancel)break;l=h.features[0].geometry.coordinates[0]}l=o.fromLngLat(l);const c=await Ke(o,[l[0].x,l[0].y,l[2].x,l[1].y],s,void 0,t!=null?t:o._includeWholeEntity,i);o._selectFeatures.push(...c.features)}return o._selectFeatures},ve=async(o,s,t,e,r,i,a)=>{r&&r(`\u8BF7\u9009\u62E9\u8981${e?"\u5220\u9664":"\u4FEE\u6539"}\u7684CAD\u5B9E\u4F53\u5BF9\u8C61\uFF0C\u6309\u53F3\u952E\u7ED3\u675F`),Ye(o);const n=V(s,"hideEntityObjectIds"),l=await Je(o,!0,!0,!a,!0,n?new Set(n):void 0);if(!l||l.length==0)return;const c=new Set,h=new Set,f=new Set;l.forEach(y=>{y.properties.objectid&&h.add(y.properties.objectid),y.id&&f.add(parseInt(y.id));const A=$(y.properties.objectid);A&&c.add(A)});const g=async(y,A)=>{o.hasVectorLayer()?await t.addHideObjectIds(Array.from(f)):await t.addHideObjectIds(Array.from(h));const L=V(s,"deleteEntitys")||[];L.push(...Array.from(c));const D=V(s,"hideEntityObjectIds")||[];D.push(...Array.from(h));const C=V(s,"hideEntityIds")||[];if(C.push(...Array.from(h)),_e(s,{deleteEntitys:Array.from(new Set(L)),hideEntityObjectIds:Array.from(new Set(D)),hideEntityIds:Array.from(new Set(C))}),!e){let v=o.getService().currentMapParam(),w={};A&&y&&(w=y[0]);const S=await G(o,Array.from(c).map(T=>({objectid:T,...w})),t==null?void 0:t.getClipBounds(),null,null,`${v.mapid}/${v.version}`);let k=s.getAll().features.length;if(W(S,s,!0),y){const T=s.getAll().features;for(let I=k;I<T.length;I++){let O=I-k;if(!y[O])continue;const j=T[I].id;s.setFeatureProperty(j,"export",{...y[O].export,...Ae(o,{features:S.features.filter(N=>{var z,Q,ne;return((z=N.properties)==null?void 0:z.objectid)==((ne=(Q=T[I])==null?void 0:Q.properties)==null?void 0:ne.objectid)})})})}}}we(o)},d=()=>{we(o)},m=(y,A)=>{let L;const D=new Set;for(let C=0;C<y.length;C++){const v=y[C].properties,w=$(v.objectid);if(D.has(w)||(D.add(w),!(v.name=="AcDbText"||v.name=="AcDbMText")))continue;const k=v.name=="AcDbText"?{text:A!=null?A:v.text,isText:!0}:{contents:A!=null?A:v.text,isMText:!0};k.export={position:u.default.GeoPoint.fromString(v.location||v.position),height:v.height||v.textHeight,contents:A,cloneObjectId:$(v.objectid),textRotate:v.rotate||0},L=L!=null?L:{},L[D.size-1]=k}return L};if(!e&&c.size==1&&(l[0].properties.name=="AcDbText"||l[0].properties.name=="AcDbMText")){const y=prompt("\u8BF7\u8F93\u5165\u8981\u4FEE\u6539\u7684\u6587\u5B57\u5185\u5BB9",l[0].properties.text);if(y==""||y==null){d();return}else await g(m(l,y),!0)}else i?await i(`\u4F60\u786E\u5B9A\u8981${e?"\u5220\u9664":"\u4FEE\u6539"} \u8FD9 ${c.size} \u4E2Acad\u5B9E\u4F53\u5BF9\u8C61 ?`)?await g(m(l)):d():await g()},lt=async(o,s,t,e,r,i)=>{try{await ve(o,s,t,!0,e,r,i)}catch(a){e&&e(a)}},ut=async(o,s,t,e,r,i)=>{try{await ve(o,s,t,!1,e,r,i)}catch(a){e&&e(a)}},G=async(o,s=[],t=null,e=null,r=null,i=null)=>{let a=new u.default.DbDocument;e&&(a.environment=e),r&&(a.linetypes=r);let n=o.getService().currentMapParam();t?i&&(a.from=i,a.pickEntitys=s.map(f=>f.objectid)):(i?a.from=typeof i=="string"?i:`${i.mapid}/${i.version}`:a.from=`${n.mapid}/${n.version}`,a.pickEntitys=s.map(f=>f.objectid)),a.appendEntity(s);let c=await o.getService().cmdCreateEntitiesGeomData({filedoc:a.toDoc(),mapBounds:t||n.bounds.toArray()});if(c.error)throw c.error;const h=[];if(c&&c.result&&c.result.length>0){for(let f of c.result)if(f.geom&&f.geom.geometries){let g=o.entColorToHtmlColor(f.color);for(let d=0;d<f.geom.geometries.length;d++){let m={};f.isPolygon?(m.color=g,m.noneOutline=!0):(m.color=g,m.line_width=f.lineWidth),h.push({id:u.default.RandomID(10),type:"Feature",properties:{objectid:f.objectid,opacity:f.alpha/255,...m},geometry:f.geom.geometries[d]})}}}return{type:"FeatureCollection",features:h}},ct=async(o,s,t,e)=>{if(t=JSON.parse(t),s.set(o.toLngLat(t)),o.hasVectorLayer()){const r=V(s,"hideEntityIds")||[];r&&await e.addHideObjectIds(r)}else{const r=V(s,"hideEntityObjectIds")||[];r&&await e.addHideObjectIds(r)}},M=(o,s)=>{if(!!s)for(let t in s)o.properties[t]=s[t]},Ye=o=>{o.fire("keyup",{keyCode:27})},dt=async(o,s,t,e)=>{let r=await u.default.Draw.actionDrawPoint(o,t);r.cancel||(M(r.features[0],e),s.add(r.features[0]))},ft=async(o,s,t,e)=>{let r=await u.default.Draw.actionDrawLineSting(o,t);r.cancel||(M(r.features[0],e),s.add(r.features[0]))},ht=async(o,s,t,e)=>{let r=await u.default.Draw.actionDrawPolygon(o,t);r.cancel||(M(r.features[0],e),s.add(r.features[0]))},gt=async(o,s,t,e)=>{let r=await u.default.Draw.actionDrawPolygon(o,t);r.cancel||(M(r.features[0],e),s.add(r.features[0]))},ie=o=>{if(o.geometry.type=="Polygon")return o.geometry.type="LineString",o.geometry.coordinates=o.geometry.coordinates[0],o},yt=async(o,s,t,e,r)=>{let i=await u.default.Draw.actionDrawCircle(o,t);i.cancel||(M(i.features[0],e),r||(i.features[0]=ie(i.features[0]),M(i.features[0],{isCircle:void 0})),s.add(i.features[0]))},mt=async(o,s,t,e,r)=>{let i=await u.default.Draw.actionDrawRectangle(o,t);i.cancel||(M(i.features[0],e),r||(i.features[0]=ie(i.features[0])),s.add(i.features[0]))},pt=async(o,s,t,e,r)=>{let i=await u.default.Draw.actionDrawSlantRectangle(o,t);i.cancel||(M(i.features[0],e),r||(i.features[0]=ie(i.features[0])),s.add(i.features[0]))},At=async(o,s,t,e)=>{let r=await u.default.Draw.actionSelect(o,s);if(r.features.length==0)return;e&&e("\u8BF7\u6307\u5B9A\u7684\u65CB\u8F6C\u7684\u57FA\u70B9");let i=await u.default.Draw.actionDrawPoint(o,{});if(i.cancel)return;e&&e("\u8BF7\u6307\u5B9A\u8981\u65CB\u8F6C\u7684\u89D2\u5EA6");let a=i.features[0].geometry.coordinates,n=a,l=new u.default.Polyline({data:[a,n],lineColor:"yellow",lineWidth:1,lineDasharray:[2,2]});l.addTo(o);let c=u.default.cloneDeep(r.features),h=await u.default.Draw.actionDrawPoint(o,{...t,updatecoordinate:f=>{if(!f.lnglat)return;n=f.lnglat,l.setData([a,n]);let g=o.fromLngLat(n).angleTo(o.fromLngLat(a)),d=u.default.cloneDeep(c);for(let m=0;m<d.length;m++){let y=u.default.transform.convert(d[m],A=>{let D=o.fromLngLat(A).roateAround(g,o.fromLngLat(a));return o.toLngLat(D)});s.setFeatureProperty(d[m].id,"coordinates",y)}s.forceRefresh()}});if(l.remove(),h.cancel){for(let f=0;f<c.length;f++)s.setFeatureProperty(c[f].id,"coordinates",c[f]);s.forceRefresh();return}},wt=(o,s)=>{let t=s.getSelected().features.filter(i=>i.geometry.type=="LineString"||i.geometry.type=="Polygon");if(t.length==0)return;let e=u.default.cloneDeep(t);for(let i=0;i<t.length;i++){let a=t[i];if(a.geometry.type=="LineString"){const n=u.default.polylineToBezierCurve(o.fromLngLat(a.geometry.coordinates).map(c=>[c.x,c.y])),l=u.default.bezierCurveToPolyline(n,100);s.setFeatureProperty(a.id,"coordinates",o.toLngLat(l))}else{let n=[];for(let l=0;l<a.geometry.coordinates.length;l++){const c=u.default.polylineToBezierCurve(o.fromLngLat(a.geometry.coordinates[l]).map(f=>[f.x,f.y])),h=u.default.bezierCurveToPolyline(c,1e3);n.push(o.toLngLat(h))}s.setFeatureProperty(a.id,"coordinates",n)}}let r=s.getSelected().features.filter(i=>i.geometry.type=="LineString"||i.geometry.type=="Polygon");o.fire("draw.update",{action:"toBezierCurve",features:u.default.cloneDeep(r),prevFeatures:e,styleId:s.options.styleId}),s.changeMode("simple_select")},De=async(o,s,t,e,r,i,a)=>{var y,A,L,D,C;let n=await u.default.Draw.actionDrawPoint(o,{...t});if(n.cancel)return;let l=o.fromLngLat(n.features[0].geometry.coordinates),c;if(i?c=new u.default.EllipseFill({center:l,majorAxisRadius:0,minorAxisRadius:0,fillColor:(y=e==null?void 0:e.color)!=null?y:"green",fillOpacity:(A=e==null?void 0:e.opacity)!=null?A:.8,fillOutlineColor:(L=e==null?void 0:e.outlineColor)!=null?L:"#f00"}):c=new u.default.EllipseEdge({center:l,majorAxisRadius:0,minorAxisRadius:0,lineColor:(D=e==null?void 0:e.outlineColor)!=null?D:"red",lineWidth:(C=e==null?void 0:e.line_width)!=null?C:3}),c.addTo(o),(await u.default.Draw.actionDrawPoint(o,{...t,updatecoordinate:v=>{if(!v.lnglat)return;const w=o.fromLngLat(v.lnglat);c.setMinorAxisRadius(l.distanceTo(w)),c.setMajorAxisRadius(l.distanceTo(w))}})).cancel){c.remove();return}if((await u.default.Draw.actionDrawPoint(o,{...t,updatecoordinate:v=>{if(!v.lnglat)return;const w=o.fromLngLat(v.lnglat);c.setMinorAxisRadius(l.distanceTo(w))}})).cancel){c.remove();return}if(a){if((await u.default.Draw.actionDrawPoint(o,{...t,updatecoordinate:S=>{if(!S.lnglat)return;const k=o.fromLngLat(S.lnglat);c.setStartAngle(u.default.radiansToDegrees(k.angleTo(l)))}})).cancel){c.remove();return}if((await u.default.Draw.actionDrawPoint(o,{...t,updatecoordinate:S=>{if(!S.lnglat)return;const k=o.fromLngLat(S.lnglat);c.setEndAngle(u.default.radiansToDegrees(k.angleTo(l)))}})).cancel){c.remove();return}}let g=c.getData();if((await u.default.Draw.actionDrawPoint(o,{...t,updatecoordinate:v=>{if(!v.lnglat)return;let S=o.fromLngLat(v.lnglat).angleTo(l),k=u.default.cloneDeep(g),T;i?T=k.features[0].geometry.coordinates[0]:T=k.features[0].geometry.coordinates;for(let I=0;I<T.length;I++){let O=o.fromLngLat(T[I]);O=O.roateAround(S,l),O=o.toLngLat(O),T[I]=O}c.setData(k)}})).cancel){c.remove();return}let m=c.getData().features[0];m.id=u.default.RandomID(10),m.properties={...e},s.add(m),c.remove()},bt=(o,s,t,e,r)=>{De(o,s,t,e,r,!0)},Lt=(o,s,t,e,r)=>{De(o,s,t,e,r,!1)},vt=(o,s,t,e,r)=>{De(o,s,t,e,r,!0,!0)},Dt=(o,s,t,e,r)=>{De(o,s,t,e,r,!1,!0)},Ce=o=>{let s=[];u.default.transform.convert(o,e=>(s.push(u.default.geoPoint(e)),e));let t=new u.default.GeoBounds;return t.update(s),t},oe=async(o,s,t,e,r)=>{var n,l;const i=s.createDrawLayer();r=r!=null?r:{};const a=()=>{i&&s.removeDrawLayer(i),s.setIsInteracting(!1)};try{let c=Ce(o),h=s.fromLngLat(s.getCenter()),f=s.pixelToGeoLength((n=r.drawInitPixelLength)!=null?n:100,s.getZoom()),g=s.fromLngLat(c),d=f/g.width(),m=f/g.height(),y=Math.min(d,m),A=c.center();r.baseAlign=="leftBottom"?A=c.min:r.baseAlign=="leftTop"&&(A=u.default.geoPoint([c.min.x,c.max.y]));let L=U(s,u.default.cloneDeep(o),s.fromLngLat(A),h,y),D=s.fromLngLat(Ce(L)),C=D.center();r.baseAlign=="leftBottom"?C=D.min:r.baseAlign=="leftTop"&&(C=u.default.geoPoint([D.min.x,D.max.y])),W(L,i),e&&e("\u8BF7\u79FB\u52A8\u9F20\u6807\u81F3\u6307\u5B9A\u4F4D\u7F6E\u70B9\u51FB\u8FDB\u884C\u7ED8\u5236"),s.setIsInteracting(!0);let v=u.default.cloneDeep(i.getAll()),w=await u.default.Draw.actionDrawPoint(s,{...t,updatecoordinate:j=>{if(!j.lnglat)return;i.deleteAll();const N=s.fromLngLat(j.lnglat);let z=U(s,u.default.cloneDeep(v),C,N);i.set(z)}});if(w.cancel){a();return}let S=s.fromLngLat(w.features[0].geometry.coordinates),k=new u.default.Polyline({data:s.toLngLat([S,S]),lineColor:(l=r.tempLineColor)!=null?l:"yellow",lineWidth:1,lineDasharray:[2,2]});k.addTo(s);let T=1;if(!r.disableScale){let j=await u.default.Draw.actionDrawPoint(s,{...t,updatecoordinate:Q=>{if(i.deleteAll(),!Q.lnglat)return;const ne=s.fromLngLat(Q.lnglat);let Vr=ne.distanceTo(S)/(D.width()/2),jr=U(s,u.default.cloneDeep(v),C,S,Vr);i.set(jr),k.setData(s.toLngLat([S,ne]))}});if(j.cancel){a(),k.remove();return}T=s.fromLngLat(j.features[0].geometry.coordinates).distanceTo(S)/(D.width()/2),T<1e-4&&(T=.1),k.setData(s.toLngLat([S,S]))}let I=0;if(!r.disableRotate){let j=await u.default.Draw.actionDrawPoint(s,{...t,updatecoordinate:N=>{if(i.deleteAll(),!N.lnglat)return;const z=s.fromLngLat(N.lnglat);I=z.angleTo(S)*180/Math.PI;let Q=U(s,u.default.cloneDeep(v),C,S,T,I);i.set(Q),k.setData(s.toLngLat([S,z]))}});if(k.remove(),j.cancel){I=0;let N=U(s,u.default.cloneDeep(v),C,S,T,I);i.set(N)}}s.setIsInteracting(!1);let O=i.getAll();return s.removeDrawLayer(i),{feature:O,rotation:I}}catch{a()}},Ct=async(o,s,t,e,r,i)=>{var L,D,C,v,w,S,k,T;i=i||{};let a=new u.default.DbLineType;a.name="my_arrow_dash",a.comments="\u865A\u7EBF",a.style=[{method:"numDashes",parameter:4},{method:"patternLength",parameter:1},{method:"dashLengthAt",parameter:[0,.5]},{method:"dashLengthAt",parameter:[1,-.2]},{method:"dashLengthAt",parameter:[2,.1]},{method:"dashLengthAt",parameter:[3,-.2]}];let n=[],l=(L=i.arrowShape)!=null?L:[[10,60],[150,20],[140,40],[190,0],[140,-40],[150,-20],[10,-40],[10,60]],h=u.default.getGeoBounds(l.map(I=>u.default.geoPoint(I))).scale(3).toArray(),f=new u.default.DbPolyline;f.lineWidth=(D=i.lineWidth)!=null?D:50,f.points=l,i.noLineType||(f.linetype="my_arrow_dash",f.linetypeScale=30),f.color=o.htmlColorToEntColor((C=e==null?void 0:e.outlineColor)!=null?C:u.default.randomColor());let g=(v=e==null?void 0:e.color)!=null?v:u.default.randomColor(),d=new u.default.DbHatch;if(d.pattern="SOLID",d.color=o.htmlColorToEntColor(g),d.points=l,d.alpha=100*((w=e==null?void 0:e.opacity)!=null?w:1),n.push(f,d),!i.noText){let I=new u.default.DbText({position:(S=i.textPositon)!=null?S:[100,70],contents:(k=i.contents)!=null?k:"\u7BAD\u5934",color:o.htmlColorToEntColor(g),horizontalMode:4,height:(T=i.textHeight)!=null?T:20});n.push(I)}let y=await G(o,n,h,{LWDISPLAY:!0},[a]),A=await oe(y,o,t,r);!A||s.add(A==null?void 0:A.feature)},St=async(o,s,t,e,r,i)=>{var c,h,f,g,d;i=i||{};let a=await u.default.Draw.actionDrawLineSting(o,{...t});if(a.cancel)return;let n=o.fromLngLat(a.features[0].geometry.coordinates),l=new u.default.DbPolyline;if(l.objectid=(c=i.objectid)!=null?c:"40D",l.color=u.default.htmlColorToEntColor((h=e==null?void 0:e.color)!=null?h:u.default.randomColor()),l.linetypeScale=(f=i.linetypeScale)!=null?f:100,l.points=n.map(m=>[m.x,m.y]),l){let m=await G(o,[l],null,null,null,{mapid:(g=i.mapid)!=null?g:"sys_symbols",version:(d=i.version)!=null?d:"v1"});W(m,s)}},vr=(o,s,t)=>{let e=null,r=new Date;return function(){let i=this,a=arguments,n=new Date;clearTimeout(e),n-r>=t?(o.apply(i,a),r=n):e=setTimeout(function(){o.apply(i,a)},s)}},kt=async(o,s,t,e,r,i)=>{var g;i=i!=null?i:{};let a=u.default.htmlColorToEntColor((g=e==null?void 0:e.color)!=null?g:u.default.randomColor());const n=async(d,m)=>{var A,L,D,C;let y={};if(y.objectid=(A=i==null?void 0:i.objectid)!=null?A:"40E",y.color=m,y.linetypeScale=(L=i==null?void 0:i.linetypeScale)!=null?L:100,y.fitPoints=d.map(v=>[v.x,v.y]),y)return await G(o,[y],null,null,null,{mapid:(D=i==null?void 0:i.mapid)!=null?D:"sys_symbols",version:(C=i==null?void 0:i.version)!=null?C:"v1"})};let l=o.createDrawLayer(),c=await u.default.Draw.actionDrawLineSting(o,{...t,updatecoordinate:vr(async d=>{let m=o.fromLngLat(d.feature.coordinates),y=await n(m,a);l&&l.set(y)},200,300)});if(o.removeDrawLayer(l),l=null,c.cancel)return;let h=o.fromLngLat(c.features[0].geometry.coordinates),f=await n(h,a);f&&W(f,s)},xt=async(o,s,t,e,r,i)=>{var c,h,f,g,d;i=i!=null?i:{};let a=await u.default.Draw.actionDrawPolygon(o,{...t});if(a.cancel)return;let n=o.fromLngLat(a.features[0].geometry.coordinates[0]),l=new u.default.DbHatch;if(l.objectid=(c=i.objectid)!=null?c:"42F",l.color=u.default.htmlColorToEntColor((h=e==null?void 0:e.color)!=null?h:u.default.randomColor()),l.patternScale=(f=i.patternScale)!=null?f:400,l.points=n.map(m=>[m.x,m.y]),l){let m=await G(o,[l],null,null,null,{mapid:(g=i.mapid)!=null?g:"sys_symbols",version:(d=i.version)!=null?d:"v1"});W(m,s)}},Dr=async(o,s,t)=>{t=t!=null?t:{};let e=await o.getService().conditionQueryFeature({fields:"",includegeom:!0,realgeom:!0,limit:1e4,...s});const r=[];if(e&&e.result&&e.result.length>0){for(let i of e.result)if(i.geom&&i.geom.geometries){let a=o.entColorToHtmlColor(i.color);for(let n=0;n<i.geom.geometries.length;n++)r.push({id:u.default.RandomID(10),type:"Feature",properties:{objectid:i.objectid+"_"+n,color:a,alpha:i.alpha/255,lineWidth:1,name:i.name,isline:i.isline,layerindex:i.layerindex,...t},geometry:i.geom.geometries[n]})}}return{type:"FeatureCollection",features:r}},It=async(o,s,t,e,r,i)=>{var m,y,A;i=i!=null?i:{},r&&r("\u8BF7\u79FB\u52A8\u9F20\u6807\u5C06\u8981\u7ED8\u5236\u7684\u7B26\u53F7\u79FB\u52A8\u81F3\u6307\u5B9A\u4F4D\u7F6E\u70B9\u51FB\u8FDB\u884C\u7ED8\u5236");let a=(m=i.mapid)!=null?m:"sys_symbols",n=(y=i.version)!=null?y:"v1",c=await o.getService().getStyleLayerName(a,n,!0),h=await Dr(o,{mapid:a,version:n,layer:c,condition:(A=i.condition)!=null?A:"layerindex=1"},{symbolId:u.default.RandomID()}),f=await oe(h,o,t,r,{baseAlign:"center"});if(!f)return;W(f.feature,s);let g=s.getAll().features,d=g[g.length-1].id;for(let L in e)s.setFeatureProperty(d,L,e[L])},Tt=async(o,s,t,e,r)=>{var d,m;if(e=e||{},!e.text)return;let i=[-1e3,-1e3,1e3,1e3],a=[],n={position:[0,0],contents:e.text,color:o.htmlColorToEntColor(e.color),horizontalMode:u.default.DbTextHorzMode.kTextLeft,verticalMode:u.default.DbTextVertMode.kTextBottom,height:10},l=new u.default.DbText(n);a.push(l);let c=await G(o,a,i);const h=new u.default.GeoProjection(u.default.GeoBounds.fromArray(i));let f=Ae(h,c);n={...n,...f};let g=await oe(c,o,t,r,{baseAlign:"leftBottom",drawInitPixelLength:(d=e.height)!=null?d:50,disableRotate:e==null?void 0:e.disableRotate,disableScale:e==null?void 0:e.disableScale});!g||(g.feature.features[0].properties=(m=g.feature.features[0].properties)!=null?m:{},g.feature.features[0].properties.export=n,s.add(g.feature))},W=(o,s,t)=>{const e=new Set;if(t&&o.features.forEach(r=>{r&&r.properties&&r.properties.objectid&&e.add(r.properties.objectid)}),!t||e.size==0){let r=[];return o.features.forEach(i=>{r.push(...s.add(i))}),s.changeMode("simple_select",{featureIds:r}),s.combineFeatures(),r.length}else{for(let r of e){let i=[];o.features.forEach(a=>{a.properties.objectid==r&&i.push(...s.add(a))}),i.length!=0&&(s.changeMode("simple_select",{featureIds:i}),s.combineFeatures())}return e.size}},Ft=async(o,s,t)=>{let e=o.getService();if(t){let r=s.reduce((i,a)=>(a.isOff||i.push(a.name),i),[]);Qe(o,r)}else await o.switchLayers(e,s.reduce((r,i)=>(i.isOff||r.push(i.name),r),[]))},Qe=(o,s)=>{debugger;const t=c=>i.getMapLayers().findIndex(h=>h.name===c),e=(c,h)=>{Array.isArray(c)||(c=[c]);let f=[];return h||(f=c.map(g=>t(g))),f.length==0&&(f=[-1]),["match",["get","layer"],f,!0,!1]};let r=o.getStyle(),i=o.getService(),n=i.vectorStyle().layers.map(c=>c.id),l=e(s,!1);for(let c=0;c<r.layers.length;c++)n.includes(r.layers[c].id)&&(r.layers[c].filter=l);o.setStyle(r)},Pt=(o,s,t)=>{if(o.hasVectorLayer()){const e=o.layersBySource("vector-source");for(let r of e){const i=o.getLayer(r);i.type=="fill"?o.setFillOpacity(r,s):i.type=="line"?o.setLineOpacity(r,s):i.type=="circle"&&o.setCircleOpacity(r,s)}}if(t){const r=o.getStyle().layers.filter(i=>i.id.indexOf(t)>=0);for(let i of r)o.setRasterOpacity(i.id,s)}else{const e=o.getService().rasterLayerId();o.getLayer(e)&&o.setRasterOpacity(o.getService().rasterLayerId(),s)}},Et=(o,s)=>{const t=o.getStyle().layers;t.length!=0&&o.moveLayer(s,t[0].id)};let J,ae;async function Mt(o,s){switch(ae=s,s!="measureCancel"&&(await Bt(o),J||(J={},Le(o,J))),s){case"measureDist":Cr(o,J);break;case"measureArea":Ir(o,J);break;case"measureAngle":Pr(o,J);break;case"measureCoordinate":Br(o,J);break;case"measureCancel":await Bt(o);break}}const Bt=async o=>{o.fire("keyup",{keyCode:27}),await le(100),o.fire("keyup",{keyCode:27}),await le(100),o.setIsInteracting(!1)};let Y;const F=(o,s)=>{o?Y?Y.setHTML(o):Y=new u.default.Popup({className:"my-custom-popup",closeOnClick:!1,closeButton:!1}).setHTML(o).setMaxWidth("500px").trackPointer().addTo(s):Y&&(Y.setLngLat([0,0]),Y.remove(),Y=null)},Cr=async(o,s)=>{for(;!((await Sr(o,s)).exit===!0||ae!="measureDist"););},Sr=async(o,s)=>{let t=!1,e=await u.default.Draw.actionDrawLineSting(o,{api:{getSnapFeatures:s},updatecoordinate:a=>{if(!a.lnglat)return;t=!0;const n=o.fromLngLat(a.feature.coordinates[a.feature.coordinates.length-1]);let l=`<span style="color: #16417C">\u3010\u6D4B\u91CF\u8DDD\u79BB\u3011\u5F53\u524D\u5750\u6807:<span style="color: #ff0000"> ${n.x.toFixed(2)}, ${n.y.toFixed(2)}</span>`;if(a.feature.coordinates.length==1)l+="<br/>\u8BF7\u6307\u5B9A\u8981\u6D4B\u91CF\u7684\u7B2C\u4E00\u70B9\u7684\u5750\u6807\u4F4D\u7F6E";else{let c=a.feature.coordinates.length;l+="<br/>\u6309Alt\u952E\u53D6\u6355\u6349; Ctrl\u952E\u542F\u7528\u6B63\u4EA4; \u9000\u683C\u952E\u5220\u9664\u4E0A\u4E00\u4E2A\u70B9",l+=`<br/>\u8DDD\u4E0A\u4E00\u70B9\u8DDD\u79BB: <span style="color: #ff0000">${qe(o,[a.feature.coordinates[c-2],a.feature.coordinates[c-1]])}</span>`,l+=`;  \u5F53\u524D\u603B\u7684\u8DDD\u79BB: <span style="color: #ff0000">${qe(o,a.feature.coordinates)}</span></span>`}F(l,o)},contextMenu:a=>{new u.default.ContextMenu({event:a.event.originalEvent,theme:"dark",width:"250px",items:[{label:"\u786E\u8BA4",onClick:()=>{o.fire("keyup",{keyCode:13}),F("",o)}},{label:"\u53D6\u6D88",onClick:()=>{o.fire("keyup",{keyCode:27}),F("",o)}},{label:"\u5220\u9664\u4E0A\u4E00\u4E2A\u70B9",onClick:()=>{o.fire("keyup",{keyCode:8})}},{label:"\u7ED3\u675F\u6D4B\u8DDD",onClick:()=>{o.fire("keyup",{keyCode:27}),t=!1,F("",o)}}]})}});if(e.cancel)return F("",o),{cancel:!0,exit:t===!1};let r=u.default.randomColor(),i=new u.default.Polyline({data:e.features[0].geometry.coordinates,lineColor:r,lineWidth:2});return i.addTo(o),kr(o,e.features[0].geometry.coordinates,r,i.sourceId||"",s),{polyline:i}},kr=(o,s,t,e,r)=>{let i=[];for(let c=1;c<s.length;c++){let h=new u.default.Text({text:qe(o,s.slice(0,c+1)),anchor:"left",offset:[3,0],style:{cursor:"pointer",opacity:.8,padding:"6px","border-radius":"12px","background-color":t,"border-width":0,"box-shadow":"0px 2px 6px 0px rgba(97,113,166,0.2)","text-align":"center","font-size":"14px",color:`#${t.substring(1).split("").map(f=>(15-parseInt(f,16)).toString(16)).join("")}`}});h.setLngLat(s[c]).addTo(o),i.push(h)}const a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAbNJREFUWEftlrFOAkEQhv9Z4XgJOCrlTgp5ABOhMBoTCws7EzUaeAx5A0sDiYmFxpLGaAkU2KqFArHi4CU4cMccAQN6HHcIwZi7cnd25tt/5maHsOCPFhwfPoAnBarhQFIIccjAkV3qCMhKKct6q1tym1pPAHVVOWMg6+ScgKuYYR7PBaCmKmw5XgLiy4b5NhzkXVVWP4BXa00zTNcXc21oOR4AjAswaX9M2n4u1yLBIoiSbmV0Zcdc0pqd1HdbWwUWDuDqRjMy8lQDM4o54sYRoJcKq6qHclePKnuScQ0pd/RWt2ztVyOhLUFckIwTvWneDiLYnXdVA18O+r/dcNXXIsozCGsMzuhGJ98DUINpAuUAqmhGe33k/JjiG9g4K2ADUFdDOQan7QAIlI8Z7YwP4CvgK/C/FahFlQcwtm0bEeNFa5qJuSpgdT2AzkFyU290H3udMBzYgBD3gnAQa5iFuQJ4eZB6A8ovW/ETgARLmfIyaPZVSZIQRTBdas326Thwx7fAzRA6SREB2l0x2ndTAfTnwH0CrGk4PinY6D5VQHyhNcwbp3N/eyDxduPprH0FPgHEyH4wGIHUYwAAAABJRU5ErkJggg==";let n=document.createElement("div");n.className="marker",n.style.backgroundImage=`url(${a})`,n.style.width="20px",n.style.height="20px",n.style.backgroundSize="100%",n.style.cursor="pointer",n.addEventListener("click",function(c){o.removeSourceEx(e),i.forEach(h=>h.remove()),i=[],o.fire("keyup",{keyCode:8})});let l=new u.default.Marker({element:n,anchor:"right"});l.setLngLat(s[0]).setOffset([-5,0]).addTo(o),i.push(l),Xe(r,s)},qe=(o,s)=>{let t=u.default.Math2D.lineDist(o.fromLngLat(s)),e="m";return t>=1e3?(t/=1e3,e="km"):t<.01&&(t*=100,e="cm"),t.toFixed(2)+" "+e},Xe=(o,s)=>{o.features.push({type:"Feature",geometry:{type:"LineString",coordinates:[...s]}})},xr=async(o,s)=>{let t=!1,e=await u.default.Draw.actionDrawPolygon(o,{api:{getSnapFeatures:s},updatecoordinate:a=>{if(!a.lnglat)return;t=!0;const n=o.fromLngLat(a.feature.coordinates[0][a.feature.coordinates.length-1]);let l=`<span style="color: #16417C">\u3010\u6D4B\u91CF\u9762\u79EF\u3011\u5F53\u524D\u5750\u6807:<span style="color: #ff0000"> ${n.x.toFixed(2)}, ${n.y.toFixed(2)}</span>`;a.feature.coordinates[0].length==1?l+="<br/>\u8BF7\u6307\u5B9A\u8981\u6D4B\u91CF\u7684\u7B2C\u4E00\u70B9\u7684\u5750\u6807\u4F4D\u7F6E":(l+="<br/>\u6309Alt\u952E\u53D6\u6355\u6349; Ctrl\u952E\u542F\u7528\u6B63\u4EA4; \u9000\u683C\u952E\u5220\u9664\u4E0A\u4E00\u4E2A\u70B9",l+=`<br/>\u5F53\u524D\u9762\u79EF: <span style="color: #ff0000">${Ot(o,a.feature.coordinates[0])}</span></span>`),F(l,o)},contextMenu:a=>{new u.default.ContextMenu({event:a.event.originalEvent,theme:"dark",width:"250px",items:[{label:"\u786E\u8BA4",onClick:()=>{o.fire("keyup",{keyCode:13}),F("",o)}},{label:"\u53D6\u6D88",onClick:()=>{o.fire("keyup",{keyCode:27}),F("",o)}},{label:"\u5220\u9664\u4E0A\u4E00\u4E2A\u70B9",onClick:()=>{o.fire("keyup",{keyCode:8})}},{label:"\u7ED3\u675F\u6D4B\u9762\u79EF",onClick:()=>{o.fire("keyup",{keyCode:27}),t=!1,F("",o)}}]})}});if(e.cancel)return F("",o),{cancel:!0,exit:t===!1};let r=u.default.randomColor(),i=new u.default.Polygon({data:e.features[0].geometry.coordinates[0],fillColor:r,fillOpacity:.4,fillOutlineColor:r});return i.addTo(o),Tr(o,e.features[0].geometry.coordinates[0],r,i.sourceId||"",s),{polygon:i}},Ir=async(o,s)=>{for(;!((await xr(o,s)).exit===!0||ae!="measureArea"););},Tr=(o,s,t,e,r)=>{let i=[];const a=u.default.polygonCentroid(o.fromLngLat(s));let n=new u.default.Text({text:Ot(o,s),anchor:"center",offset:[0,0],style:{cursor:"pointer",opacity:.8,padding:"6px","border-radius":"12px","background-color":`#${t.substring(1).split("").map(f=>(15-parseInt(f,16)).toString(16)).join("")}`,"border-width":0,"box-shadow":"0px 2px 6px 0px rgba(97,113,166,0.2)","text-align":"center","font-size":"14px",color:t}});n.setLngLat(o.toLngLat(a)).addTo(o),i.push(n);const l="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAbNJREFUWEftlrFOAkEQhv9Z4XgJOCrlTgp5ABOhMBoTCws7EzUaeAx5A0sDiYmFxpLGaAkU2KqFArHi4CU4cMccAQN6HHcIwZi7cnd25tt/5maHsOCPFhwfPoAnBarhQFIIccjAkV3qCMhKKct6q1tym1pPAHVVOWMg6+ScgKuYYR7PBaCmKmw5XgLiy4b5NhzkXVVWP4BXa00zTNcXc21oOR4AjAswaX9M2n4u1yLBIoiSbmV0Zcdc0pqd1HdbWwUWDuDqRjMy8lQDM4o54sYRoJcKq6qHclePKnuScQ0pd/RWt2ztVyOhLUFckIwTvWneDiLYnXdVA18O+r/dcNXXIsozCGsMzuhGJ98DUINpAuUAqmhGe33k/JjiG9g4K2ADUFdDOQan7QAIlI8Z7YwP4CvgK/C/FahFlQcwtm0bEeNFa5qJuSpgdT2AzkFyU290H3udMBzYgBD3gnAQa5iFuQJ4eZB6A8ovW/ETgARLmfIyaPZVSZIQRTBdas326Thwx7fAzRA6SREB2l0x2ndTAfTnwH0CrGk4PinY6D5VQHyhNcwbp3N/eyDxduPprH0FPgHEyH4wGIHUYwAAAABJRU5ErkJggg==";let c=document.createElement("div");c.className="marker",c.style.backgroundImage=`url(${l})`,c.style.width="20px",c.style.height="20px",c.style.backgroundSize="100%",c.style.cursor="pointer",c.addEventListener("click",function(f){o.removeSourceEx(e),i.forEach(g=>g.remove()),i=[]});let h=new u.default.Marker({element:c,anchor:"right"});h.setLngLat(s[0]).setOffset([-5,0]).addTo(o),i.push(h),Xe(r,s)},Ot=(o,s)=>{let t=u.default.calcPolygonArea(o.fromLngLat(s)),e="m\xB2";return t>=1e6?(t/=1e6,e="km\xB2"):t<1/1e4&&(t*=1e4,e="cm\xB2"),t.toFixed(2)+" "+e},Fr=async(o,s)=>{let t=!1,e=await u.default.Draw.actionDrawLineSting(o,{pointCount:3,api:{getSnapFeatures:s},updatecoordinate:a=>{if(!a.lnglat)return;t=!0;const n=o.fromLngLat(a.feature.coordinates[a.feature.coordinates.length-1]);let l=`<span style="color: #16417C">\u3010\u6D4B\u91CF\u89D2\u5EA6\u3011\u5F53\u524D\u5750\u6807:<span style="color: #ff0000"> ${n.x.toFixed(2)}, ${n.y.toFixed(2)}</span>`;a.feature.coordinates.length==1?l+="<br/>\u8BF7\u6307\u5B9A\u8981\u6D4B\u91CF\u7684\u7B2C\u4E00\u70B9\u7684\u5750\u6807\u4F4D\u7F6E":(a.feature.coordinates.length,l+="<br/>\u6309Alt\u952E\u53D6\u6355\u6349; Ctrl\u952E\u542F\u7528\u6B63\u4EA4; \u9000\u683C\u952E\u5220\u9664\u4E0A\u4E00\u4E2A\u70B9",l+=`<br/>\u5F53\u524D\u89D2\u5EA6: <span style="color: #ff0000">${Rt(o,a.feature.coordinates).angle}</span></span>`),F(l,o)},contextMenu:a=>{new u.default.ContextMenu({event:a.event.originalEvent,theme:"dark",width:"250px",items:[{label:"\u786E\u8BA4",onClick:()=>{o.fire("keyup",{keyCode:13}),F("",o)}},{label:"\u53D6\u6D88",onClick:()=>{o.fire("keyup",{keyCode:27}),F("",o)}},{label:"\u5220\u9664\u4E0A\u4E00\u4E2A\u70B9",onClick:()=>{o.fire("keyup",{keyCode:8})}},{label:"\u7ED3\u675F\u6D4B\u89D2\u5EA6",onClick:()=>{o.fire("keyup",{keyCode:27}),t=!1,F("",o)}}]})}});if(e.cancel)return F("",o),{cancel:!0,exit:t===!1};let r=u.default.randomColor(),i=new u.default.Polyline({data:e.features[0].geometry.coordinates,lineColor:r,lineWidth:2});return i.addTo(o),Er(o,e.features[0].geometry.coordinates,r,i.sourceId||"",s),{polyline:i}},Pr=async(o,s)=>{for(;!((await Fr(o,s)).exit===!0||ae!="measureAngle"););},Er=(o,s,t,e,r)=>{if(s.length<3)return;let i=[],a=o.fromLngLat(s);s[1];let n=Rt(o,s);const l=u.default.getCirclePolygonCoordinates(a[1],a[1].distanceTo(a[0])/4,36,n.startAngle,n.endAngle,!1);let c=new u.default.Polyline({data:o.toLngLat(l),lineColor:t,lineWidth:2});c.addTo(o),i.push(c);let h=c.getData().features[0].geometry.coordinates,f=h[Math.ceil(h.length/2)],g=u.default.radiansToDegrees(-o.fromLngLat(f).angleTo(a[1]))+90;g>90?g+=180:g>270&&(g-=180);let d=new u.default.Text({text:n.angle,anchor:"center",rotation:g,offset:[0,0],style:{cursor:"pointer",opacity:.8,padding:"6px","border-radius":"12px","background-color":t,"border-width":0,"box-shadow":"0px 2px 6px 0px rgba(97,113,166,0.2)","text-align":"center","font-size":"14px",color:`#${t.substring(1).split("").map(L=>(15-parseInt(L,16)).toString(16)).join("")}`}});d.setLngLat(f).addTo(o),i.push(d);const m="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAbNJREFUWEftlrFOAkEQhv9Z4XgJOCrlTgp5ABOhMBoTCws7EzUaeAx5A0sDiYmFxpLGaAkU2KqFArHi4CU4cMccAQN6HHcIwZi7cnd25tt/5maHsOCPFhwfPoAnBarhQFIIccjAkV3qCMhKKct6q1tym1pPAHVVOWMg6+ScgKuYYR7PBaCmKmw5XgLiy4b5NhzkXVVWP4BXa00zTNcXc21oOR4AjAswaX9M2n4u1yLBIoiSbmV0Zcdc0pqd1HdbWwUWDuDqRjMy8lQDM4o54sYRoJcKq6qHclePKnuScQ0pd/RWt2ztVyOhLUFckIwTvWneDiLYnXdVA18O+r/dcNXXIsozCGsMzuhGJ98DUINpAuUAqmhGe33k/JjiG9g4K2ADUFdDOQan7QAIlI8Z7YwP4CvgK/C/FahFlQcwtm0bEeNFa5qJuSpgdT2AzkFyU290H3udMBzYgBD3gnAQa5iFuQJ4eZB6A8ovW/ETgARLmfIyaPZVSZIQRTBdas326Thwx7fAzRA6SREB2l0x2ndTAfTnwH0CrGk4PinY6D5VQHyhNcwbp3N/eyDxduPprH0FPgHEyH4wGIHUYwAAAABJRU5ErkJggg==";let y=document.createElement("div");y.className="marker",y.style.backgroundImage=`url(${m})`,y.style.width="20px",y.style.height="20px",y.style.backgroundSize="100%",y.style.cursor="pointer",y.addEventListener("click",function(L){o.removeSourceEx(e),i.forEach(D=>D.remove()),i=[]});let A=new u.default.Marker({element:y,anchor:"right"});A.setLngLat(s[1]).setOffset([-5,0]).addTo(o),i.push(A),Xe(r,s)},Rt=(o,s)=>{let t=o.fromLngLat(s);if(t.length<3)return{angle:0};let e=t[0].angleTo(t[1]),r=t[2].angleTo(t[1]),i=e-r,a=u.default.radiansToDegrees(i),n=!0;a<0&&(a=-a,n=!n),a>180&&(a=360-a,n=!n);let l=n?u.default.radiansToDegrees(r):u.default.radiansToDegrees(e),c=n?u.default.radiansToDegrees(e):u.default.radiansToDegrees(r);return l=l<0?360+l:l,c=c<0?360+c:c,c<l&&(c+=360),{angle:a.toFixed(2)+"\xB0",dir:n,startAngle:l,endAngle:c}},Mr=async(o,s)=>{let t=!1,e=await u.default.Draw.actionDrawPoint(o,{api:{getSnapFeatures:s},updatecoordinate:r=>{if(!r.lnglat)return;t=!0;const i=o.fromLngLat(r.lnglat);let a=`<span style="color: #16417C">\u3010\u6D4B\u91CF\u5750\u6807\u3011\u5F53\u524D\u5750\u6807:<span style="color: #ff0000"> ${i.x.toFixed(2)}, ${i.y.toFixed(2)}</span></span>`;F(a,o)},contextMenu:r=>{new u.default.ContextMenu({event:r.event.originalEvent,theme:"dark",width:"250px",items:[{label:"\u786E\u8BA4",onClick:()=>{o.fire("keyup",{keyCode:13}),F("",o)}},{label:"\u53D6\u6D88",onClick:()=>{o.fire("keyup",{keyCode:27}),F("",o)}},{label:"\u7ED3\u675F\u6D4B\u5750\u6807",onClick:()=>{o.fire("keyup",{keyCode:27}),t=!1,F("",o)}}]})}});return e.cancel?(F("",o),{cancel:!0,exit:t===!1}):(Or(o,e.features[0].geometry.coordinates),{point:e})},Br=async(o,s)=>{for(;!((await Mr(o,s)).exit===!0||ae!="measureCoordinate"););},Or=(o,s)=>{let t=[],e=o.fromLngLat(s),r=`X: ${e.x.toFixed(2)}, Y: ${e.y.toFixed(2)}`,i=Rr(o,s,r);t.push(i);const a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAbNJREFUWEftlrFOAkEQhv9Z4XgJOCrlTgp5ABOhMBoTCws7EzUaeAx5A0sDiYmFxpLGaAkU2KqFArHi4CU4cMccAQN6HHcIwZi7cnd25tt/5maHsOCPFhwfPoAnBarhQFIIccjAkV3qCMhKKct6q1tym1pPAHVVOWMg6+ScgKuYYR7PBaCmKmw5XgLiy4b5NhzkXVVWP4BXa00zTNcXc21oOR4AjAswaX9M2n4u1yLBIoiSbmV0Zcdc0pqd1HdbWwUWDuDqRjMy8lQDM4o54sYRoJcKq6qHclePKnuScQ0pd/RWt2ztVyOhLUFckIwTvWneDiLYnXdVA18O+r/dcNXXIsozCGsMzuhGJ98DUINpAuUAqmhGe33k/JjiG9g4K2ADUFdDOQan7QAIlI8Z7YwP4CvgK/C/FahFlQcwtm0bEeNFa5qJuSpgdT2AzkFyU290H3udMBzYgBD3gnAQa5iFuQJ4eZB6A8ovW/ETgARLmfIyaPZVSZIQRTBdas326Thwx7fAzRA6SREB2l0x2ndTAfTnwH0CrGk4PinY6D5VQHyhNcwbp3N/eyDxduPprH0FPgHEyH4wGIHUYwAAAABJRU5ErkJggg==";let n=document.createElement("div");n.className="marker",n.style.backgroundImage=`url(${a})`,n.style.width="20px",n.style.height="20px",n.style.backgroundSize="100%",n.style.cursor="pointer",n.addEventListener("click",function(c){t.forEach(h=>h.remove()),t=[]});let l=new u.default.Marker({element:n,anchor:"right"});l.setLngLat(s).setOffset([-5,0]).addTo(o),t.push(l)},Rr=(o,s,t)=>{let e=document.createElement("div");e.className="marker",e.style.position="absolute";let r=document.createElement("div");r.style.backgroundImage='url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAB4AAAAAlCAYAAACj1PQVAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MTJFMTU1RjExN0UzMTFFOTg3RTBFODdGNTY0NThGQkUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MTJFMTU1RjIxN0UzMTFFOTg3RTBFODdGNTY0NThGQkUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxMkUxNTVFRjE3RTMxMUU5ODdFMEU4N0Y1NjQ1OEZCRSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxMkUxNTVGMDE3RTMxMUU5ODdFMEU4N0Y1NjQ1OEZCRSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pj97JFoAAAV9SURBVHja7N1faJ1nHQfw33nzpuekaZfWNFmbLHXWdf7DWgvebF4M0SEZhTG8mKvFyzG9UJFKh9peVGnd0DkE/10Ic6s6BBEGbshggho3BVGnRnC2s1n/ras2J2uzc05PXp+3yZzSm7XJkvfi84HveZ9z3ve8F7/bL8/71oqiiMs8NhCLsCllfcpfAwAAAAAAAIDlsXM68jfgtl9K2Z3Sa8IAAAAAAAAAb7hjKW8uF9kS3/jdKR9PaZkxAAAAAAAAwPJa6h3A96X0pBxK+bLxAgAAAAAAACyfpSyAP5jy4ZQXUh747687p00ZAAAAAAAAYBlkS3if+xfW+1MuGC0AAAAAAADA8lqqAnh3yvaUZ1MeMlYAAAAAAACA5bcUBXBfyoGF9edSusYKAAAAAAAAsPyWogD+VMpYypMpTxgpAAAAAAAAwMpYbAG8IWVvylzKHuMEAAAAAAAAWDmLLYC/mDKQ8nDKH4wTAAAAAAAAYOUspgC+IeWelNmYL4IBAAAAAAAAWEGLKYAPpfSmfD1lyigBAAAAAAAAVtbVFsA3pdyR8lLMF8EAAAAAAAAArLCrKYBrKfcvHA+kNI0RAAAAAAAAYOVdTQFc7vwtdwA/l/ItIwQAAAAAAACohistgMt3/h5cWO9N6RghAAAAAAAAQDVcaQF8d8rWlImUnxgfAAAAAAAAQHVcSQF8Tcq+lCJlz8IRAAAAAAAAgIq4kgK4fOTzUMzv/J0wOgAAAAAAAIBqeb0F8FjKp2P+nb97jQ0AAAAAAACgel5vAXwgpS/l2ynPGRsAAAAAAABA9eSjd370sh+P7/q/r9tTdqc0Y74IBgAAAAAAAKCC8v9Zl7uB6yn9o4fHG+lYS2n/867Hv5bXivLcoZQzRgYAAAAAAABQTfnw5nvjxWMHe9N6cP+OyVtv2nj2ruFG6209WbGqM5c181rx9m5RO/ngn2/4zlf/tLV2fNfPCmMDAAAAAAAAqJ68LH+HGq2xRz7wu2+8a31zvCgiLs5FlC3vqp4YKS8638mzqZf7tqXlb1MuGBsAAAAAAABA9ZSPdh58tfyd7UScOh9xYjqLszNZlGVwN6U/71z7hR1/e/g9g9NbRg+P9xobAAAAAAAAQPVk+3ZMfujV8vf0TC3WXWzE9ZveHyNjt0UxOxCnp7NotiPWr2pfl67dk/6zxtgAAAAAAAAAqie7eePZXeVO33OtiOGsHqtvfjDi1scibnkkesafipHVI3HuQi3a3Yh3rpsZT/+5ZvTweM3oAAAAAAAAAKolH2q0byzf+dtuZ9G/8b0RW+587ezat0a84xPR+8z+aHU7MVDvbLhl05lrf3FyaGr08Hj5muA4/qMfmiIAAAAAAABABWS1KPJLTW75UR+8/Ir6uksvCi6K+a/Dfa26sQEAAAAAAABUT/ZyJz+Z19IiL6J7eiLi/NRrZ4tuxNEfRzvmorcnoj2XvfL41MZTMV8XAwAAAAAAAFAh2eS5tU9kWcRAo4ipC9MRP98ZMfnNiH/8IOLJO+LMC7+ORl83Gj0RR5r9z8x08nOhAAYAAAAAAAConPyzT2976H1D//7YYL21ZW5NN442n4/ep/ddeuxzK+air68bb2pEdCN75dEj192Xfp4xNgAAAAAAAIDqyWY6+akHnt16d7Oz6uRAPWJkoIi1azuxek0nhge6MdQXUatlrZ8+P/L5706+ZSLKXhgAAAAAAACAyik3+s5+/++bJ+751fbbfv/S+kc7c/l0WQSva0TUe2rtIzNrJr7yxxs/8pnfbPteurY5vPlej38GAAAAAAAAqKC8LHRfPHZw9penNvwl5ZP1nrmB268/MdafX+x96sTQ8aMz/f9K102ntJS/AAAAAAAAANX1HwEGAM75MhcANnAkAAAAAElFTkSuQmCC")',r.style.backgroundRepeat="no-repeat",r.style.height="37px",r.style.width="100px",r.style.position="absolute",r.style.left="-3px",r.style.bottom="-3px",r.style.right="0px",e.appendChild(r);let i=document.createElement("div");i.style.height="50px",i.style.width="350px",i.style.position="absolute",i.style.left="97px",i.style.top="-60px",i.style.border="solid 1px #8E0EFF",i.style.background="linear-gradient(#00ffff, #00ffff) left top,  linear-gradient(#00ffff, #00ffff) left top,     linear-gradient(#00ffff, #00ffff) right bottom,    linear-gradient(#00ffff, #00ffff) right bottom",i.style.backgroundRepeat="no-repeat",i.style.backgroundColor="rgba(87,255,255, 0.3)",i.style.backgroundSize="1px 6px, 6px 1px",i.style.fontSize="18px",i.style.color="#ffffff",i.innerHTML=`<div style='margin: 15px 5px 15px 5px'>${t}</div>`,e.appendChild(i);let a=new u.default.Marker({element:e,anchor:"bottom-left"});return a.setLngLat(s).addTo(o),a},Vt=(o,s)=>o.hasVectorLayer()?et(o,s):$e(o,s),$e=(o,s)=>{s=s||{};const t=o.getService(),e=new Set;let r="",i={};const a=g=>{var d,m;i={backcolor:(d=t.currentMapParam())!=null&&d.darkMode?0:16777215,expression:r,...g,...s==null?void 0:s.style},o.updateStyle(t,{name:(m=s==null?void 0:s.styleName)!=null?m:"myCustomStyle_temp",...i})},n=g=>{let d="";return g!==void 0&&(d+=`gOutVisible:=${g?1:0};`),d},l=g=>(Array.isArray(g)||(g=[g]),`gInObjectId  in  '${g.join("||")}'`),c=async()=>{if(e.size==0)r="",await a();else{let g=l(Array.from(e)),d=n(!1);r=`if(${g}) {${d} } `,await a()}};return{addHideObjectIds:async(g,d,m)=>{m&&e.clear(),g.forEach(y=>e.add(y)),d||await c()},refresh:c,hideObjectIds:e,getClipBounds:()=>{var g,d;if((g=s==null?void 0:s.style)!=null&&g.clipbounds)return(d=s==null?void 0:s.style)==null?void 0:d.clipbounds}}},et=(o,s)=>{const t=o.getService(),e=new Set,r=l=>(Array.isArray(l)||(l=[l]),["match",["id"],l,!0,!1]),i=async()=>{let l=t.vectorStyle().layers.map(h=>h.id),c=Array.from(e);o.setFilterEx(l,["!",r(c)])};return{addHideObjectIds:async(l,c,h)=>{h&&e.clear(),l.forEach(f=>e.add(f)),c||await i()},refresh:i,hideObjectIds:e,getClipBounds:()=>{var l,c;if((l=s==null?void 0:s.style)!=null&&l.clipbounds)return(c=s==null?void 0:s.style)==null?void 0:c.clipbounds}}};p.CacheDbStorage=Fe,p.LayerBase=x,p.MapApp=at,p.ProcessDataToFeatureCollection=de,p.TsIndexDb=_,p.WmsOverlayMapType=Oe,p.addExportRefInfoInText=Ae,p.addFeaturesToDraw=W,p.addHighLightSourceLayer=Ze,p.base2OverlayCoordinate=ot,p.cacheStorage=X,p.cad2webCoordinate=ze,p.cancelDraw=Ye,p.clearHighLightSourceLayer=se,p.clearHighlight=we,p.convertArrayToGeoJson=fe,p.createGeomData=G,p.createHatch=xt,p.createLineTypeCurve=kt,p.createLineTypePolyline=St,p.createMapStyleLayerName=te,p.createOutSymbol=It,p.createUpdateMapStyleObj=Vt,p.createUpdateMapStyleRasterObj=$e,p.createUpdateMapStyleVectorObj=et,p.default=tt,p.deleteCadEntity=lt,p.deleteOrModifyCadEntity=ve,p.drawArrow=Ct,p.drawCircle=yt,p.drawEllipseArc=Dt,p.drawEllipseEdge=Lt,p.drawEllipseFill=bt,p.drawEllipseFillArc=vt,p.drawFillExrusion=gt,p.drawLineSting=ft,p.drawPoint=dt,p.drawPolygon=ht,p.drawRectangle=mt,p.drawSlantRectangle=pt,p.drawText=Tt,p.evalDataConvert=Pe,p.execProgram=Se,p.exportDwg=nt,p.gaodeProviderTiles=Me,p.getEntityObjectId=$,p.getGeoJsonBounds=Ce,p.getHighlightEntities=Ke,p.getInstance=Te,p.getMapSnapPoints=Le,p.getShardsTileUrl=ue,p.getTileShards=ke,p.getTrackFeatureProperty=V,p.getWmsAutoCadBaseMapTileUrl=He,p.getWmsAutoWebBaseMapTileUrl=Ne,p.getWmsDirectTileUrl=je,p.getWmsMapsBounds=Re,p.getWmsParamTileUrl=Ge,p.getWmsTileUrl=We,p.initIndexDb=Ie,p.interactiveCreateGeom=oe,p.isAlphanumeric=ce,p.isTrackFeature=re,p.isWebBaseMap=R,p.listenKeyEvent=he,p.loadDataToDraw=ct,p.loadWebMap=Be,p.modifyCadEntity=ut,p.osmProviderTiles=st,p.overlay2BaseCoordinate=Ue,p.polygonToPolyline=ie,p.providerLayers=xe,p.queryMapData=ee,p.requestChangeData=Z,p.runMeasureCmd=Mt,p.selectFeatures=Je,p.selectRotate=At,p.setFeatureProperty=M,p.setLayerOpacity=Pt,p.setLayerToLowest=Et,p.setTrackFeatureProperty=_e,p.sleep=le,p.switchCadLayers=Ft,p.switchVectorLayers=Qe,p.tiandituProviderTiles=Ee,p.toBezierCurve=wt,p.toMapLayer=P,p.toProperties=H,p.transformGeoJsonData=U,p.web2cadCoordinate=it,Object.defineProperties(p,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=vjcommon.min.js.map
